# é¡¹ç›®ç®€ä»‹

## å¾®å¤´æ¡ä¸šåŠ¡ç®€ä»‹

> å¾®å¤´æ¡æ–°é—»å‘å¸ƒå’Œæµè§ˆå¹³å°,ä¸»è¦åŒ…å«ä¸šåŠ¡å¦‚ä¸‹

+ ç”¨æˆ·åŠŸèƒ½
  + æ³¨å†ŒåŠŸèƒ½
  + ç™»å½•åŠŸèƒ½
+ å¤´æ¡æ–°é—»
  + æ–°é—»çš„åˆ†é¡µæµè§ˆ
  + é€šè¿‡æ ‡é¢˜å…³é”®å­—æœç´¢æ–°é—»
  + æŸ¥çœ‹æ–°é—»è¯¦æƒ…
  + æ–°é—»çš„ä¿®æ”¹å’Œåˆ é™¤
+ æƒé™æ§åˆ¶
  + ç”¨æˆ·åªèƒ½ä¿®æ”¹å’Œè‡ªå·±å‘å¸ƒçš„å¤´æ¡æ–°é—»

## æŠ€æœ¯æ ˆä»‹ç»

> å‰ç«¯æŠ€æœ¯æ ˆ

+ ES6 ä½œä¸ºåŸºç¡€ JS è¯­æ³•
+ nodejs ç”¨äºè¿è¡Œç¯å¢ƒ
+ npm ç”¨äºé¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·
+ vite ç”¨äºé¡¹ç›®çš„æ„å»ºæ¶å·¥å…·
+ Vue3 ç”¨äºé¡¹ç›®æ•°æ®çš„æ¸²æŸ“æ¡†æ¶
+ Axios ç”¨äºå‰åç«¯æ•°æ®çš„äº¤äº’
+ Router ç”¨äºé¡µé¢çš„è·³è½¬
+ Pinia ç”¨äºå­˜å‚¨ç”¨æˆ·çš„æ•°æ®
+ LocalStorage ä½œä¸ºç”¨æˆ·æ ¡éªŒ token çš„å­˜å‚¨æ‰‹æ®µ
+ Element-Plus æä¾›ç»„ä»¶

> åç«¯æŠ€æœ¯æ ˆ

+ JAVA ä½œä¸ºå¼€å‘è¯­è¨€ï¼Œç‰ˆæœ¬ä¸º JDK17
+ Tomcat ä½œä¸ºæœåŠ¡å®¹å™¨ï¼Œç‰ˆæœ¬ä¸º10.1.7
+ Mysql8 ç”¨äºé¡¹ç›®å­˜å‚¨æ•°æ®
+ Servlet ç”¨äºæ§åˆ¶å±‚å®ç°å‰åç«¯æ•°æ®äº¤äº’
+ JDBC ç”¨äºå®ç°æ•°æ®çš„ CURD
+ Druid ç”¨äºæä¾›æ•°æ®æºçš„è¿æ¥æ± 
+ MD5 ç”¨äºç”¨æˆ·å¯†ç çš„åŠ å¯†
+ Jwt ç”¨äº token çš„ç”Ÿæˆå’Œæ ¡éªŒ
+ Jackson ç”¨äºè½¬æ¢ JSON
+ Filter ç”¨äºç”¨æˆ·ç™»å½•æ ¡éªŒå’Œè·¨åŸŸå¤„ç†
+ Lombok ç”¨äºå¤„ç†å®ä½“ç±»

## åŠŸèƒ½å±•ç¤º

**å¤´æ¡é¦–é¡µä¿¡æ¯æœç´¢**

![1687657562841](images/1687657562841.png)

**ç™»å½•åŠŸèƒ½**

![1683883374643](images/1683883374643.png)

**æ³¨å†ŒåŠŸèƒ½**

![1683883394612](images/1683883394612.png)

**æƒé™æ§åˆ¶åŠŸèƒ½**

![1687657603246](images/1687657603246.png)

**å‘å¸ƒå¤´æ¡åŠŸèƒ½**

![1683883660552](images/1683883660552.png)

**ä¿®æ”¹å¤´æ¡åŠŸèƒ½**

![1683883695289](images/1683883695289.png)

**åˆ é™¤å¤´æ¡åŠŸèƒ½**

![1683883724768](images/1683883724768.png)

# å‰ç«¯é¡¹ç›®ç¯å¢ƒæ­å»º

**åˆ›å»ºé¡¹ç›®ï¼Œå®‰è£…ä¾èµ– :**

```shell
npm create vite
cd é¡¹ç›®ç›®å½•
npm install
npm install vue-router
npm install axios
npm install pinia
npm install element-plus
npm install nprogress
npm add -D sass
npm install mitt
```

## è·¯ç”±

> src/router/index.js

**é…ç½®è·¯ç”±**

```javascript
import { createRouter, createWebHashHistory } from 'vue-router'

let router = createRouter({
  history: createWebHashHistory(),
  routes: []
})

export default router
```

**é…ç½® main.js**

```javascript
import { createApp } from 'vue'

import App from './App.vue'

// å¯¼å…¥è·¯ç”±
import router from './router/index.js'

let app = createApp(App)

// å…¨å±€ä½¿ç”¨è·¯ç”±
app.use(router)

app.mount('#app')
```

**ä¿®æ”¹ App.vue**

```html
<script setup>
import { computed } from "vue"
import { useRoute } from 'vue-router'
import Header from './components/Header.vue'

const route = useRoute() // è·¯ç”±ä¿¡æ¯å¯¹è±¡

// åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºheaderç»„ä»¶
 const isHeader =  computed(() => {
    return route.name !== "Login" && route.name !== "Register" && route.name !== "addNews";
})
</script>

<template>
  <div>
    <Header v-show="isHeader"></Header>
    <!-- è§†å›¾çš„å±•ç¤ºä½ç½® -->
    <router-view></router-view>
  </div>
</template>

<style scoped></style>
```

## pinia

**src/stores ä¸‹åˆ›å»º index.js æ–‡ä»¶**

```java
// å¯¼å…¥piniaç»„ä»¶
import { createPinia } from 'pinia';
// åˆ›å»ºpiniaå¯¹è±¡
const pinia = createPinia();
// å¯¼å‡ºé»˜è®¤çš„pinia
export default pinia;
```

**main.js ä¸­ä½¿ç”¨ pinia**

```javascript
import { createApp } from 'vue'

import App from './App.vue'

// å¯¼å…¥piniaå¯¹è±¡
import pinia from './stores';

let app = createApp(App)

// å…¨å±€ä½¿ç”¨pinia
app.use(pinia)

app.mount('#app')
```

## element-plus

**åœ¨ main.js å¼•å…¥ element-plus**

```javascript
import { createApp } from 'vue'

import App from './App.vue'

//å¯¼å…¥element-plusç›¸å…³å†…å®¹
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
import zhCn from 'element-plus/es/locale/lang/zh-cn'

let app = createApp(App)

// å…¨å±€ä½¿ç”¨ElementPlus
app.use(ElementPlus, {
  locale: zhCn,
})

app.mount('#app')
```

## NProgress

### ğŸ å†™åœ¨å‰é¢

NProgress æ˜¯ä¸€ä¸ªè½»é‡çº§çš„è¿›åº¦æ¡ç»„ä»¶ï¼Œåœ¨ Github ä¸Šå·²ç» 2.4 ä¸‡ star æ•°äº†ï¼Œè™½ç„¶è¿™ä¸ªç»„ä»¶å·²ç»å¥½ä¹…æ²¡æœ‰æ›´æ–°äº†ï¼Œæœ€è¿‘ä¸€æ¬¡æ›´æ–°æ˜¯ 20 å¹´ 4 æœˆä»½ï¼Œæ”¹äº† jQuery çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯è¯¥ç»„ä»¶çš„ä½¿ç”¨é¢‘ç‡è¿˜æ˜¯é«˜çš„ã€‚

### ğŸ‘ åœ¨é¡¹ç›®ä¸­å®‰è£…

è¿™é‡Œçš„åŒ…ç®¡ç†å·¥å…·ä½¿ç”¨çš„ npmï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ yarn æˆ–è€… pnpmï¼Œè¯·è‡ªè¡Œæ›´æ”¹å®‰è£…å‘½ä»¤ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š

```shell
npm i nprogress -S
```

å¦‚æœæ˜¯ TS çš„é¡¹ç›®ï¼Œè¿˜éœ€è¦å®‰è£…å…¶ç±»å‹å£°æ˜æ–‡ä»¶ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š

```shell
npm i @types/nprogress -D
```

### ğŸ’ ç®€å•çš„å°è£…

ç°åœ¨æˆ‘ä»¬å¯¹ NProgress è¿›è¡Œä¸€ä¸‹ç®€å•çš„å°è£…ï¼Œé¦–å…ˆæˆ‘ä»¬åœ¨ `utils` ç›®å½•ä¸‹åˆ›å»ºè¦ç»™ `nporgress.js` çš„æ–‡ä»¶ï¼Œç„¶åå¼•å…¥ NProgress å’Œ CSS æ ·å¼æ–‡ä»¶ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```javascript
import NProgress from 'nprogress'
import 'nprogress/nprogress.css'
```

ç„¶åæˆ‘ä»¬å¯¹è¿›åº¦æ¡è¿›è¡Œä¸€äº›åŸºç¡€é…ç½®ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```javascript
//å…¨å±€è¿›åº¦æ¡çš„é…ç½®
NProgress.configure({
  easing: 'ease', // åŠ¨ç”»æ–¹å¼
  speed: 1000, // é€’å¢è¿›åº¦æ¡çš„é€Ÿåº¦
  showSpinner: false, // æ˜¯å¦æ˜¾ç¤ºåŠ è½½ico
  trickleSpeed: 200, // è‡ªåŠ¨é€’å¢é—´éš”
  minimum: 0.3, // æ›´æ”¹å¯åŠ¨æ—¶ä½¿ç”¨çš„æœ€å°ç™¾åˆ†æ¯”
  parent: 'body', //æŒ‡å®šè¿›åº¦æ¡çš„çˆ¶å®¹å™¨
})
```

æœ€åæˆ‘ä»¬å°è£…ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯å¼€å§‹æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ç»“æŸçš„æ–¹æ³•ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```javascript
// æ‰“å¼€è¿›åº¦æ¡
export const start = () => {
  NProgress.start()
}

// å…³é—­è¿›åº¦æ¡
export const close = () => {
  NProgress.done()
}
```

### ğŸ“ åœ¨ Vue åˆ‡æ¢è·¯ç”±æ—¶å±•ç¤ºè¿›åº¦æ¡

ç°åœ¨æˆ‘ä»¬å°±æ¥ä½¿ç”¨æˆ‘ä»¬ä¸Šé¢å°è£…çš„ Nprogressï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨ VueRouter çš„é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œå®ç°åˆ‡æ¢è·¯ç”±æ—¶åœ¨é¡¶éƒ¨å±•ç¤ºè¿›åº¦æ¡ï¼Œé¦–å…ˆæˆ‘ä»¬æ‰“å¼€ VueRouter çš„é…ç½®æ–‡ä»¶ï¼Œç„¶åå¼•å…¥æˆ‘ä»¬å°è£…çš„ Nprogressï¼š

```javascript
import { close, start } from '/@/utils/nprogress'
```

ç„¶åæˆ‘ä»¬åœ¨åˆ›å»ºçš„ Router å®ä¾‹ä¸­ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š

```javascript
router.beforeEach((pre, next) => {
  start()
})

router.afterEach(() => {
  close()
})
```

- `beforeEach`ï¼šè·¯ç”±åˆ‡æ¢ä¹‹å‰è§¦å‘ï¼›
- `afterEach`ï¼šè·¯ç”±åˆ‡æ¢å®Œæˆåè§¦å‘ï¼›

ç°åœ¨æˆ‘ä»¬åˆ‡æ¢è·¯ç”±å°±å¯ä»¥å®ç°é¡¶éƒ¨è¿›åº¦æ¡çš„åˆ‡æ¢ã€‚

## å‰µå»º request.js å·¥å…·é¡

> åœ¨ `utils` ç›®å½•ä¸‹åˆ›å»ºè¦ç»™ `request.js` çš„æ–‡ä»¶

```javascript
import axios from "axios";
import { ElMessage } from 'element-plus';
import NProgress from "nprogress";
import "nprogress/nprogress.css";

// é…ç½®æ–°å»ºä¸€ä¸ª axios å®ä¾‹
const service = axios.create({
  baseURL: "http://localhost:8080/",
  timeout: 50000,
});

// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨
service.interceptors.request.use((config) => {
  NProgress.start()//å¼€å¯è¿›åº¦æ¡

  return config;
});

// æ·»åŠ å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(
  (response) => {
    NProgress.done()//å…³é—­è¿›åº¦æ¡

    if (response.data.code !== 200) {
      // åˆ¤æ–­å“åº”çŠ¶æ€ç 
      if (response.data.code == 501) return Promise.reject(ElMessage.error("ç”¨æˆ·åæœ‰è¯¯"))
      else if (response.data.code == 503) return Promise.reject(ElMessage.error("å¯†ç æœ‰è¯¯"))
      else if (response.data.code == 504) return Promise.reject(ElMessage.error("ç™»å½•å·²è¿‡æœŸ"))
      else if (response.data.code == 505) return Promise.reject(ElMessage.error("ç”¨æˆ·åå ç”¨"))
    } else {
      return response.data.data; /* è¿”å›æˆåŠŸå“åº”æ•°æ®ä¸­çš„dataå±æ€§æ•°æ® */
    }
  },
  (error) => {
    NProgress.done()//å…³é—­è¿›åº¦æ¡
    return Promise.reject(error.message);
  }
);

export default service;
```

## å¯¹ api è¿›è¡Œå°è£…ç»Ÿä¸€ç®¡ç†

> åœ¨ `api` ç›®å½•ä¸‹åˆ›å»ºè¦ç»™ `index.js` çš„æ–‡ä»¶

```javascript
// ç›®å‰æ˜¯ç©ºçš„
```

## å‰µå»ºé é¢

Step1 åœ¨ src ä¸‹å‰µå»º pages ç›®éŒ„ï¼Œæ¥è‘—åœ¨ pages ç›®éŒ„è£¡é¢åˆ†åˆ¥å‰µå»º AddOrModifyNewsã€Detailã€HeadlineNewsã€Loginã€Registerï¼Œæœ€å¾Œåœ¨æ¯å€‹ç›®éŒ„åº•ä¸‹æ–°å»º index.vueã€‚

<img src="E:\JavaWeb\é–‹ç™¼æ¡ˆä¾‹\å¾®å¤´æ¡é¡¹ç›®å¼€å‘\images\è¢å¹•æ“·å–ç•«é¢ 2024-05-08 095933.png" style="zoom:50%;" />

Step2 åœ¨ router ç›®éŒ„ä¸‹å‰µå»º routes.js æ–‡ä»¶ï¼Œé…ç½®éœæ…‹è·¯ç”±

```javascript
export const staticRoutes = [
  {
    path: "/",
    redirect: "/headlinenews",
  },
  {
    // å¤´æ¡
    path: "/headlinenews",
    component: () => import("../pages/HeadlineNews/index.vue"),
    name: "HeadlineNews",
  },
  {
    //å¤´æ¡è¯¦æƒ…
    path: "/detail",
    component: () => import("../pages/Detail/index.vue"),
    name: "Detail",
  },
  {
    // ç™»å½•
    path: "/login",
    component: () => import("../pages/Login/index.vue"),
    name: "Login",
  },
  {
    //æ³¨å†Œ
    path: "/register",
    component: () => import("../pages/Register/index.vue"),
    name: "Register",
  },
  {
    //å‘å¸ƒæ–°é—»çš„é¡µé¢
    path: "/addormodifynews",
    component: () => import("../pages/addOrModifyNews/index.vue"),
    name: "addOrModifyNews",
  },
];
```

Step3 åœ¨ router ç›®éŒ„ä¸‹çš„  index.js ä¸­å¼•å…¥ä¸¦ä½¿ç”¨ staticRoutes

```javascript
import { createRouter, createWebHashHistory } from 'vue-router'
import { staticRoutes } from "./routes.js";

let router = createRouter({
  history: createWebHashHistory(),
  routes: staticRoutes
})

export default router
```

## Vite é…ç½®ä»£ç† Proxyï¼Œé¿å…è·¨åŸŸå’Œé‡å¤ç¼–å†™ url çš„é—®é¢˜

æˆ‘ä»¬åœ¨ç¼–å†™å‰ç«¯é¡¹ç›®çš„æ—¶å€™ï¼Œç»å¸¸ä¼šé‡åˆ°è·¨åŸŸçš„é—®é¢˜ï¼Œå½“æˆ‘ä»¬è®¿é—®åç«¯ API çš„ URL è·¯å¾„æ—¶ï¼Œåªè¦åŸŸåã€ç«¯å£æˆ–è®¿é—®åè®®ï¼ˆå¦‚ HTTP å’Œ HTTPSï¼‰æœ‰ä¸€é¡¹ä¸åŒï¼Œå°±ä¼šè¢«æµè§ˆå™¨è®¤å®šä¸ºè·¨åŸŸã€‚å¦å¤–æˆ‘ä»¬ä¹Ÿä¼šç»å¸¸é‡å¤ç¼–å†™åç«¯çš„åŸŸåï¼Œä¾‹å¦‚ `https://example.com/api/some_end_point`ï¼Œ`https://example.com/api/other_end_point`ï¼Œé’ˆå¯¹è¿™ä¸¤ç§æƒ…å†µï¼Œå¯ä»¥ç›´æ¥ç”¨åŒä¸€ä¸ªé…ç½®æ¥è§£å†³ï¼Œå³ä»£ç†é…ç½®ã€‚

ä¸ç®¡æ˜¯ Vite è¿˜æ˜¯ Webpackï¼Œè¿™äº›æ‰“åŒ…å·¥å…·éƒ½æ”¯æŒè®¾ç½®å‰ç«¯ä»£ç†ï¼Œå®ƒä»¬èƒ½å¤ŸæŠŠå¯¹æŸä¸€æ®µ URL çš„è®¿é—®ç›´æ¥è½¬æ¢æˆå¦ä¸€ä¸ªçœŸå®çš„åç«¯ API åœ°å€ï¼Œè¿™æ ·å‰åç«¯å°±è§†ä¸ºä½¿ç”¨äº†ç›¸åŒçš„åŸŸåã€åè®®å’Œç«¯å£ï¼Œå°±é¿å…äº†è·¨åŸŸçš„é—®é¢˜ï¼Œè¿˜èƒ½é¿å…ç¹ççš„åå¤ç¼–å†™åŸŸåã€‚

### é…ç½® Vite Proxy

æˆ‘ä»¬è¿™é‡Œä»¥ Vite çš„é…ç½®ä¸ºä¾‹ï¼Œæ¥çœ‹ä¸€ä¸‹å¦‚ä½•ç»™ API è¯·æ±‚è®¾ç½®ä»£ç†ã€‚åœ¨ Vite ç¼–å†™çš„é¡¹ç›®é‡Œè¾¹ï¼Œæœ‰ä¸€ä¸ª `vite.config.js` é…ç½®æ–‡ä»¶ï¼Œé‡Œè¾¹æ˜¯å…³äº Vite çš„é…ç½®é¡¹ï¼Œå¯ä»¥åœ¨é‡Œè¾¹é…ç½®ä»£ç†ã€‚å‡å¦‚æˆ‘ä»¬å‰ç«¯é¡¹ç›®è·¯å¾„ä¸º `http://localhost:3000`ï¼Œéœ€è¦ä»£ç†æ‰€æœ‰ä»¥ `/api` å¼€å¤´çš„ API è¯·æ±‚ï¼ŒæŠŠå®ƒè½¬å‘åˆ° `http://localhost:3001`ï¼Œå¹¶ä¸”åç«¯çš„ API è·¯å¾„ä¸­ä¸å¸¦ `/api`å‰ç¼€ï¼Œéœ€è¦è‡ªåŠ¨å»æ‰ `/api`å‰ç¼€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](images\é…ç½® Vite Proxy.png)

é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™æ ·çš„é…ç½®ï¼š

```javascript
// vite.config.js
import { defineConfig } from "vite";

export default defineConfig({
  // ä»£ç†è·¨åŸŸé…ç½®
  server: {
    proxy: {
      "/app-dev": {
        // ç²å–æ•¸æ“šçš„æœå‹™å™¨åœ°å€è¨­ç½®
        target: "http://localhost:8080",
        // é–‹å•Ÿä»£ç†ï¼Œéœ€è¦è·¨åŸŸ
        changeOrigin: true,
        // è·¯å¾‘é‡å¯«
        rewrite: (path) => path.replace(/^\/app-dev/, ""),
      },
    },
  },
});
```

åœ¨ vite å¯¼å‡ºçš„é…ç½®é‡Œè¾¹ï¼š

- æ·»åŠ  `server`  é…ç½®é¡¹ã€‚
- åœ¨ `server` é…ç½®é¡¹ä¸‹è¾¹æ·»åŠ  `proxy` é…ç½®é¡¹ï¼Œå€¼ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå±æ€§åä¸ºè¦ä»£ç†çš„ URL è·¯å¾„æ®µï¼Œå€¼ä¸ºç›¸å…³çš„é…ç½®ã€‚
- è¿™é‡Œå±æ€§åè®¾ç½®ä¸º `/api`ï¼Œæ¥é…ç½®è½¬å‘å‰ç«¯ `http://localhost:3000/api` å¼€å¤´çš„æ‰€æœ‰è¯·æ±‚è·¯å¾„ã€‚

åœ¨ proxy é…ç½®å¯¹è±¡ä¸­ï¼š

- `target`ï¼Œä¸ºå®é™…çš„åç«¯ URLï¼Œå®ƒä¼šè¿½åŠ åˆ°å±æ€§åé…ç½®çš„ `/api` è¿™ä¸ªç‰‡æ®µçš„å‰é¢ï¼Œä¾‹å¦‚è®¿é—® `/api/some_end_point` ä¼šè½¬æ¢ä¸º `http://localhost:3001/api/some_end_point`ã€‚
- `changeOrigin`ï¼Œæ˜¯å¦æ”¹å†™ originï¼Œè®¾ç½®ä¸º true ä¹‹åï¼Œå°±ä¼šæŠŠè¯·æ±‚ API header ä¸­çš„ originï¼Œæ”¹æˆè·Ÿ `target` é‡Œè¾¹çš„åŸŸåä¸€æ ·äº†ã€‚
- `rewrite` å¯ä»¥æŠŠè¯·æ±‚çš„ URL è¿›è¡Œé‡å†™ï¼Œè¿™é‡Œå› ä¸ºå‡è®¾åç«¯çš„ API è·¯å¾„ä¸å¸¦ `/api` æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ `rewrite`å»æ‰ `/api`ã€‚ç»™ `rewrite` ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°çš„å‚æ•° `path` æ˜¯å‰ç«¯è¯·æ±‚çš„ API è·¯å¾„ï¼Œåé¢ç›´æ¥ä½¿ç”¨äº† `replace()` æ–¹æ³•ï¼Œåœ¨é‡Œé¢å†™ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼ŒæŠŠ `/api`å¼€å¤´çš„è¿™ä¸€æ®µæ›¿æ¢ä¸ºç©ºã€‚

è¿™æ · vite çš„ä»£ç†å°±é…ç½®å¥½äº†ã€‚åœ¨å®é™…å‰ç«¯è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ `/api/some_endpoint`è¿™æ ·çš„å½¢å¼äº†ï¼š

```javascript
fetch("/api/posts");
```

å‰é¢çš„ http åè®®ã€åŸŸåå’Œç«¯å£å°±éƒ½å¯ä»¥çœç•¥æ‰äº†ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰äº†è·¨åŸŸçš„é—®é¢˜ã€‚

### Vite é…ç½®äº†proxyï¼ŒæŸ¥çœ‹çœŸå®æ¥å£åœ°å€

å¼€å‘ç¯å¢ƒ VIte é…ç½®äº†proxyï¼Œåœ¨æ§åˆ¶å°çœ‹ä¸åˆ°å®é™…è¯·æ±‚çš„ URL

å¯ä»¥åœ¨ proxy ä½¿ç”¨ byPass()

å› ä¸ºæ— æ³•å°†å…¶æ·»åŠ åˆ°è¯·æ±‚å¤´ä¸­ï¼Œä½¿ç”¨åŠ åˆ°å“åº”å¤´æ–¹ä¾¿æŸ¥çœ‹

```javascript
export default defineConfig({
  plugins: [vue()],
  // ä»£ç†è·¨åŸŸé…ç½®
  server: {
    proxy: {
      "/app-dev": {
        // ç²å–æ•¸æ“šçš„æœå‹™å™¨åœ°å€è¨­ç½®
        target: "http://localhost:8080",
        // é–‹å•Ÿä»£ç†ï¼Œéœ€è¦è·¨åŸŸ
        changeOrigin: true,
        // è·¯å¾‘é‡å¯«
        rewrite: (path) => path.replace(/^\/app-dev/, ""),
        bypass(req, res, options) {
          const proxyURL = options.target + options.rewrite(req.url)
          console.log('proxyURL', proxyURL)
          req.headers['x-req-proxyURL'] = proxyURL // è®¾ç½®æœªç”Ÿæ•ˆ
          res.setHeader('x-req-proxyURL', proxyURL) // è®¾ç½®å“åº”å¤´å¯ä»¥çœ‹åˆ°
        },
      },
    },
  },
})
```

### å°ç»“

å‰ç«¯è·¨åŸŸé—®é¢˜å…¶å®æ˜¯ä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼Œå°±æ˜¯ä¸ºäº†é˜²æ­¢ä¸åŒåŸŸåçš„æœåŠ¡ä¹‹é—´è¿›è¡Œäº’ç›¸è®¿é—®ï¼Œä»¥é¿å…æ¶æ„ç¨‹åºå¯¹åç«¯èµ„æºè¿›è¡Œéæ³•è·å–ã€‚åœ¨å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ä»£ç†æ¥æŠŠè¯·æ±‚è¿›è¡Œä»£ç†ï¼ŒæŠŠåŸŸåç­‰æ”¹æˆä¸€æ ·çš„ï¼Œè¿™æ ·å°±é¿å…äº†è·¨è¶Šçš„é—®é¢˜ã€‚åœ¨ Vite ä¸­è®¾ç½®ä»£ç†ï¼Œæ˜¯åœ¨ `vite.config.js` é…ç½®æ–‡ä»¶é‡Œï¼Œé…ç½® `server` å±æ€§ï¼Œå¹¶åœ¨é‡Œè¾¹é…ç½® `proxy` é…ç½®é¡¹ã€‚ä»£ç†å¯ä»¥é…ç½®å¤šä¸ªï¼Œæ ¹æ®ä¸åŒçš„ API è·¯å¾„å»è¯·æ±‚ä¸åŒçš„åç«¯è·¯å¾„ï¼Œæœ¬æ–‡é‡Œåªé…ç½®äº†ä¸€ä¸ª `/api`ä½œä¸ºæ¼”ç¤ºã€‚

### æ³¨æ„é»

> è«‹å°‡ `utils` ç›®å½•ä¸‹ `request.js` çš„æ–‡ä»¶ï¼Œæ›´æ”¹ axios çš„ baseURL é…ç½®ç‚º `/app-dev`

```javascript
// æ›´æ”¹å¾Œ
// é…ç½®æ–°å»ºä¸€ä¸ª axios å®ä¾‹
const service = axios.create({
  baseURL: "/app-dev",
  timeout: 50000,
});
```

## Mitt

> åƒè€ƒæ–‡ç« 
>
> - [Vue3 ä¸­ä½¿ç”¨ Event Bus](https://www.casper.tw/development/2020/12/15/vue-3-mitt/)
> - [Vue3.x æ¨èä½¿ç”¨ mitt.js](https://juejin.cn/post/6973106775755063333)

> vue3 ä¸å†å»ºè­°ä½¿ç”¨ busï¼Œvue3 æ²’æœ‰å…§ç½® busï¼Œéœ€å¼•å…¥ mitt åº«å¯¦ç¾ bus

æ‰€è¬‚è·¨å…ƒä»¶ï¼Œå³æ˜¯å…©å€‹å…ƒä»¶ä¸¦ç„¡çˆ¶å­é—œä¿‚ï¼Œä¸¦æ²’æœ‰è¢«å°æ–¹åŒ…è‘—ã€‚å¦‚æœè¦äº’ç›¸å‚³éè³‡æ–™ï¼Œå¯ä»¥ä½¿ç”¨ mittï¼ˆåœ¨ Vue 2 æ˜¯ event busï¼‰ã€Vuex æˆ– route props ä¾†è™•ç†ã€‚

Event bus å’Œ Mitt çš„åŸç†æ˜¯ä¸€æ¨£ï¼Œå‡è¨­ç¾åœ¨æœ‰å…©å€‹å…ƒä»¶ï¼ŒA å…ƒä»¶å’Œ B å…ƒä»¶ã€‚æˆ‘æƒ³æŠŠ A å…ƒä»¶çš„è³‡æ–™å‚³çµ¦ B å…ƒä»¶ï¼Œæ­¥é©Ÿå°±æ˜¯ï¼š

1. åœ¨ A å…ƒä»¶ç™¼å‡ºæŸå€‹äº‹ä»¶
2. åœ¨ B å…ƒä»¶ä½¿ç”¨ `on` ä¾†è¨»å†Šç›£è½è©²äº‹ä»¶
3. ç•¶ B å…ƒä»¶éŠ·æ¯€æ™‚ï¼Œä½¿ç”¨ `off` æŠŠè©²ç›£è½ç§»é™¤

![](images\201183479Qh0pKnAlN.png)

**æ–¹å¼ 1ï¼Œå…¨å±€æ€»çº¿ï¼Œvue å…¥å£æ–‡ä»¶ main.js ä¸­æŒ‚è½½å…¨å±€å±æ€§ã€‚**

```javascript
import { createApp } from 'vue';
import App from './App.vue';
import mitt from "mitt"

const app = createApp(App)
app.config.globalProperties.Bus = mitt()
```

**æ–¹å¼ 2ï¼Œå°è£…è‡ªå®šä¹‰äº‹åŠ¡æ€»çº¿æ–‡ä»¶  mybus.jsï¼Œåˆ›å»ºæ–°çš„ js æ–‡ä»¶ï¼Œåœ¨ä»»ä½•ä½ æƒ³ä½¿ç”¨çš„åœ°æ–¹å¯¼å…¥å³å¯ã€‚**

```javascript
import mitt from 'mitt'
export default mitt()
```

**æ–¹å¼ 3ï¼Œç›´æ¥åœ¨ç»„ä»¶é‡Œé¢å¯¼å…¥ä½¿ç”¨ã€‚æ¨èå¤§å®¶ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå› ä¸ºåˆ†æ•£å¼æ›´æ–¹ä¾¿ç®¡ç†å’Œæ’æŸ¥é—®é¢˜ã€‚**

```html
<template>
  <img alt="Vue logo" src="./assets/logo.png" />
  <HelloWorld msg="Hello Vue 3.0 + Vite" />
</template>

<script>
import mitt from 'mitt'
import HelloWorld from './components/HelloWorld.vue'

export default {
  components: {
    HelloWorld
  },
  setup (props) {
    const formItemMitt = mitt()
    return {
      formItemMitt
    }
  }
}
</script>
```

### ç¯„ä¾‹ç¨‹å¼ç¢¼

**A.vue**

```html
<script setup>
import { getCurrentInstance, ref } from "vue"
const { Bus } = getCurrentInstance().appContext.config.globalProperties

const text = ref('é€™æœ‰ä¸€æ®µè©±')

function pushData() {
  Bus.emit('eventName', 'kevin');
}
</script>

<template>
  <div>
    {{ text }} 
    <button type="button" @click="pushData">ç™¼é€è‡³å¦ä¸€å€‹å…ƒä»¶</button>
  </div>
</template>

<style scoped></style>
```

**B.vue**

```html
<script setup>
import { getCurrentInstance, ref } from "vue"

const { Bus } = getCurrentInstance().appContext.config.globalProperties

const text = ref('åŸå§‹è³‡æ–™')

//æ¥æ”¶äº‹ä»¶çš„åœ°æ–¹ä½¿ç”¨äº‹ä»¶ç¸½ç·š
Bus.on('eventName', (payload) => {
  console.log(payload)
  //è™•ç†äº‹ä»¶
  text.value = payload
});
</script>

<template>
  <div>{{ text }}</div>
</template>

<style scoped></style>
```

**Demo.vue**

```html
<script setup>
import A from './A.vue';
import B from './B.vue';
</script>

<template>
  <div>
    <A />
    <hr>
    <B />
  </div>
</template>

<style scoped></style>
```

# åç«¯é¡¹ç›®ç¯å¢ƒæ­å»º

## æ•°æ®åº“å‡†å¤‡

> å¯¼å…¥èµ„æ–™ä¸­çš„ top_news.sql æ–‡ä»¶å³å¯

**`news_users` ç”¨æˆ·è¡¨**

<img src="images/1683188408798.png" alt="1683188408798"  />

**`news_type` æ–°é—»ç±»å‹è¡¨**

<img src="images/1683188444555.png" alt="1683188444555"  />

**`news_headline` æ–°é—»ä¿¡æ¯è¡¨**

<img src="images/1683188471933.png" alt="1683188471933"  />

## MVC é¡¹ç›®æ¶æ„æ¨¡å¼

>  MVCï¼ˆModel View Controllerï¼‰æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­çš„ä¸€ç§ **`è½¯ä»¶æ¶æ„æ¨¡å¼`**ï¼Œå®ƒæŠŠè½¯ä»¶ç³»ç»Ÿåˆ†ä¸º **`æ¨¡å‹`**ã€**`è§†å›¾`**å’Œ**`æ§åˆ¶å™¨`** ä¸‰ä¸ªåŸºæœ¬éƒ¨åˆ†ã€‚ç”¨ä¸€ç§ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ã€ç•Œé¢æ˜¾ç¤ºåˆ†ç¦»çš„æ–¹æ³•ç»„ç»‡ä»£ç ï¼Œå°†ä¸šåŠ¡é€»è¾‘èšé›†åˆ°ä¸€ä¸ªéƒ¨ä»¶é‡Œé¢ï¼Œåœ¨æ”¹è¿›å’Œä¸ªæ€§åŒ–å®šåˆ¶ç•Œé¢åŠç”¨æˆ·äº¤äº’çš„åŒæ—¶ï¼Œä¸éœ€è¦é‡æ–°ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚

+ **M**ï¼šModel æ¨¡å‹å±‚ï¼Œå…·ä½“åŠŸèƒ½å¦‚ä¸‹
  1. å­˜æ”¾å’Œæ•°æ®åº“å¯¹è±¡çš„å®ä½“ç±»ä»¥åŠä¸€äº›ç”¨äºå­˜å‚¨éæ•°æ®åº“è¡¨å®Œæ•´ç›¸å…³çš„ VO å¯¹è±¡
  2. å­˜æ”¾ä¸€äº›å¯¹æ•°æ®è¿›è¡Œé€»è¾‘è¿ç®—æ“ä½œçš„çš„ä¸€äº›ä¸šåŠ¡å¤„ç†ä»£ç 

+ **V**ï¼šView è§†å›¾å±‚ï¼Œå…·ä½“åŠŸèƒ½å¦‚ä¸‹
  1. å­˜æ”¾ä¸€äº›è§†å›¾æ–‡ä»¶ç›¸å…³çš„ä»£ç  htmlã€cssã€js ç­‰
  2. åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­ï¼Œåç«¯å·²ç»æ²¡æœ‰è§†å›¾æ–‡ä»¶ï¼Œè¯¥å±‚æ¬¡å·²ç»è¡åŒ–æˆç‹¬ç«‹çš„å‰ç«¯é¡¹ç›®

+ **C**ï¼šController æ§åˆ¶å±‚ï¼Œå…·ä½“åŠŸèƒ½å¦‚ä¸‹
  1. æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè·å¾—è¯·æ±‚æ•°æ®
   2. å°†å‡†å¤‡å¥½çš„æ•°æ®å“åº”ç»™å®¢æˆ·ç«¯

> MVC æ¨¡å¼ä¸‹ï¼Œé¡¹ç›®ä¸­çš„å¸¸è§åŒ…

+ M :
  1. å®ä½“ç±»åŒ… (pojoã€entityã€bean) ä¸“é—¨å­˜æ”¾å’Œæ•°æ®åº“å¯¹åº”çš„å®ä½“ç±»å’Œä¸€äº› VO å¯¹è±¡
  2. æ•°æ®åº“è®¿é—®åŒ… (daoã€mapper)  ä¸“é—¨å­˜æ”¾å¯¹æ•°æ®åº“ä¸åŒè¡¨æ ¼ CURD æ–¹æ³•å°è£…çš„ä¸€äº›ç±»
  3. æœåŠ¡åŒ… (service)                       ä¸“é—¨å­˜æ”¾å¯¹æ•°æ®è¿›è¡Œä¸šåŠ¡é€»è¾‘é¢„ç®—çš„ä¸€äº›ç±»

+ C :
  1. æ§åˆ¶å±‚åŒ…(controller)

+ V :
  1. web ç›®å½•ä¸‹çš„è§†å›¾èµ„æº htmlã€cssã€jsã€img ç­‰
  2. å‰ç«¯å·¥ç¨‹åŒ–åï¼Œåœ¨åç«¯é¡¹ç›®ä¸­å·²ç»ä¸å­˜åœ¨äº†

![1683363039636](images/1683363039636.png)

## æ­å»ºé¡¹ç›®

### åˆ›å»º WEB é¡¹ç›®

<img src="images\è¢å¹•æ“·å–ç•«é¢ 2024-05-08 133506.png" alt="1683350231551" style="zoom:50%;" />

### å¯¼å…¥ä¾èµ–

<img src="images\è¢å¹•æ“·å–ç•«é¢ 2024-05-08 134010.png" alt="1683351095131" style="zoom:50%;" />

### å‡†å¤‡åŒ…ç»“æ„

<img src="images\è¢å¹•æ“·å–ç•«é¢ 2024-05-08 134329.png" alt="1683350275719" style="zoom:50%;" />

+ controller æ§åˆ¶å±‚ä»£ç ï¼Œä¸»è¦ç”± Servlet ç»„æˆ
+ service     æœåŠ¡å±‚ä»£ç ï¼Œä¸»è¦ç”¨äºå¤„ç†ä¸šåŠ¡é€»è¾‘
+ dao          æ•°æ®è®¿é—®å±‚ï¼Œä¸»è¦ç”¨æˆ·å®šä¹‰å¯¹äºå„ä¸ªè¡¨æ ¼çš„ CURD çš„æ–¹æ³•
+ pojo         å®ä½“ç±»å±‚ï¼Œä¸»è¦ç”¨äºå­˜æ”¾å’Œæ•°æ®åº“å¯¹åº”çš„å®ä½“ç±»ä»¥åŠä¸€äº› VO å¯¹è±¡
+ util           å·¥å…·ç±»åŒ…ï¼Œä¸»è¦ç”¨å­˜æ”¾ä¸€äº›å·¥å…·ç±»
+ common  å…¬å…±åŒ…ï¼Œä¸»è¦ç”¨æˆ·å­˜æ”¾ä¸€äº›å…¶ä»–å…¬å…±ä»£ç 
+ filters       è¿‡æ»¤å™¨åŒ…ï¼Œä¸“é—¨ç”¨äºå­˜æ”¾ä¸€äº›è¿‡æ»¤å™¨
+ test          æµ‹è¯•ä»£ç åŒ…ï¼Œä¸“é—¨ç”¨äºå®šä¹‰ä¸€äº›æµ‹è¯•çš„åŠŸèƒ½ä»£ç ï¼Œä¸Šçº¿å‰åº”è¯¥åˆ æ‰ï¼ŒåæœŸç”¨ maven å¯ä»¥è‡ªåŠ¨å¤„ç†æ‰

## å‡†å¤‡å·¥å…·ç±»

### å¼‚æ­¥å“åº”è§„èŒƒæ ¼å¼ç±»

**Result ç±»**

```java
package com.atguigu.headline.common;

// å…¨å±€ç»Ÿä¸€è¿”å›ç»“æœç±»
public class Result<T> {
	// è¿”å›ç 
	private Integer code;
	// è¿”å›æ¶ˆæ¯
	private String message;
	// è¿”å›æ•°æ®
	private T data;

	public Result() {
	}

	// è¿”å›æ•°æ®
	protected static <T> Result<T> build(T data) {
		Result<T> result = new Result<T>();
		if (data != null)
			result.setData(data);
		return result;
	}

	public static <T> Result<T> build(T body, Integer code, String message) {
		Result<T> result = build(body);
		result.setCode(code);
		result.setMessage(message);
		return result;
	}

	public static <T> Result<T> build(T body, ResultCodeEnum resultCodeEnum) {
		Result<T> result = build(body);
		result.setCode(resultCodeEnum.getCode());
		result.setMessage(resultCodeEnum.getMessage());
		return result;
	}

	/**
	 * æ“ä½œæˆåŠŸ
	 * 
	 * @param data baseCategory1List
	 * @param <T>
	 * @return
	 */
	public static <T> Result<T> ok(T data) {
		Result<T> result = build(data);
		return build(data, ResultCodeEnum.SUCCESS);
	}

	public Result<T> message(String msg) {
		this.setMessage(msg);
		return this;
	}

	public Result<T> code(Integer code) {
		this.setCode(code);
		return this;
	}

	public Integer getCode() {
		return code;
	}

	public void setCode(Integer code) {
		this.code = code;
	}

	public String getMessage() {
		return message;
	}

	public void setMessage(String message) {
		this.message = message;
	}

	public T getData() {
		return data;
	}

	public void setData(T data) {
		this.data = data;
	}
}
```

**ResultCodeEnum æšä¸¾ç±»**

```java
package com.atguigu.headline.common;

// ç»Ÿä¸€è¿”å›ç»“æœçŠ¶æ€ä¿¡æ¯ç±»
public enum ResultCodeEnum {

	SUCCESS(200, "success"), USERNAME_ERROR(501, "usernameError"), PASSWORD_ERROR(503, "passwordError"),
	NOTLOGIN(504, "notLogin"), USERNAME_USED(505, "userNameUsed");

	private Integer code;
	private String message;

	private ResultCodeEnum(Integer code, String message) {
		this.code = code;
		this.message = message;
	}

	public Integer getCode() {
		return code;
	}

	public String getMessage() {
		return message;
	}
}
```

### MD5 åŠ å¯†å·¥å…·ç±»

```java
package com.atguigu.headline.util;

import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

public final class MD5Util {
	public static String encrypt(String strSrc) {
		try {
			char hexChars[] = { '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f' };
			byte[] bytes = strSrc.getBytes();
			MessageDigest md = MessageDigest.getInstance("MD5");
			md.update(bytes);
			bytes = md.digest();
			int j = bytes.length;
			char[] chars = new char[j * 2];
			int k = 0;
			for (int i = 0; i < bytes.length; i++) {
				byte b = bytes[i];
				chars[k++] = hexChars[b >>> 4 & 0xf];
				chars[k++] = hexChars[b & 0xf];
			}
			return new String(chars);
		} catch (NoSuchAlgorithmException e) {
			e.printStackTrace();
			throw new RuntimeException("MD5åŠ å¯†å‡ºé”™ï¼ï¼+" + e);
		}
	}
}
```

### JDBCUtil è¿æ¥æ± å·¥å…·ç±»

**æ·»åŠ  jdbc.properties é…ç½®æ–‡ä»¶**

```properties
driverClassName=com.mysql.cj.jdbc.Driver
url=jdbc:mysql://localhost:3306/schedule_system
username=root
password=root
initialSize=5
maxActive=10
maxWait=1000
```

**æ¸¬è©¦**

```java
@Test
public void getConnection() {
    Connection connection = JDBCUtil.getConnection();
    System.out.println(connection);
    JDBCUtil.releaseConnection();
}
```

```java
package com.atguigu.headline.util;

import com.alibaba.druid.pool.DruidDataSourceFactory;

import javax.sql.DataSource;
import java.io.IOException;
import java.io.InputStream;
import java.sql.Connection;
import java.sql.SQLException;
import java.util.Properties;

public class JDBCUtil {
	private static ThreadLocal<Connection> threadLocal = new ThreadLocal<>();

	private static DataSource dataSource;
	
	// åˆå§‹åŒ–è¿æ¥æ± 
	static {
		// å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¯»å–.propertiesé…ç½®æ–‡ä»¶
		Properties properties = new Properties();
		InputStream resourceAsStream = JDBCUtil.class.getClassLoader().getResourceAsStream("jdbc.properties");
		try {
			properties.load(resourceAsStream);
		} catch (IOException e) {
			throw new RuntimeException(e);
		}

		try {
			dataSource = DruidDataSourceFactory.createDataSource(properties);
		} catch (Exception e) {
			throw new RuntimeException(e);
		}

	}

	/* 1 å‘å¤–æä¾›è¿æ¥æ± çš„æ–¹æ³• */
	public static DataSource getDataSource() {
		return dataSource;
	}

	/* 2 å‘å¤–æä¾›è¿æ¥çš„æ–¹æ³• */
	public static Connection getConnection() {
		Connection connection = threadLocal.get();
		if (null == connection) {
			try {
				connection = dataSource.getConnection();
			} catch (SQLException e) {
				throw new RuntimeException(e);
			}
			threadLocal.set(connection);
		}

		return connection;
	}

	/* å®šä¹‰ä¸€ä¸ªå½’è¿˜è¿æ¥çš„æ–¹æ³• (è§£é™¤å’ŒThreadLocalä¹‹é—´çš„å…³è”å…³ç³») */
	public static void releaseConnection() {
		Connection connection = threadLocal.get();
		if (null != connection) {
			threadLocal.remove();
			// æŠŠè¿æ¥è®¾ç½®å›è‡ªåŠ¨æäº¤çš„è¿æ¥
			try {
				connection.setAutoCommit(true);
				// è‡ªåŠ¨å½’è¿˜åˆ°è¿æ¥æ± 
				connection.close();
			} catch (SQLException e) {
				throw new RuntimeException(e);
			}
		}
	}
}
```

### JwtHelper å·¥å…·ç±»

```java
package com.atguigu.headline.util;

import com.alibaba.druid.util.StringUtils;
import io.jsonwebtoken.*;

import java.util.Date;

public class JwtHelper {
	private static long tokenExpiration = 24 * 60 * 60 * 1000;
	private static String tokenSignKey = "123456";

	// ç”Ÿæˆtokenå­—ç¬¦ä¸²
	public static String createToken(Long userId) {
		String token = Jwts.builder()
				.setSubject("YYGH-USER").setExpiration(new Date(System.currentTimeMillis() + tokenExpiration))
				.claim("userId", userId).signWith(SignatureAlgorithm.HS512, tokenSignKey)
				.compressWith(CompressionCodecs.GZIP).compact();
		return token;
	}

	// ä»tokenå­—ç¬¦ä¸²è·å–userid
	public static Long getUserId(String token) {
		if (StringUtils.isEmpty(token))
			return null;
		Jws<Claims> claimsJws = Jwts.parser().setSigningKey(tokenSignKey).parseClaimsJws(token);
		Claims claims = claimsJws.getBody();
		Integer userId = (Integer) claims.get("userId");
		return userId.longValue();
	}

	// åˆ¤æ–­tokenæ˜¯å¦æœ‰æ•ˆ
	public static boolean isExpiration(String token) {
		try {
			boolean isExpire = Jwts.parser().setSigningKey(tokenSignKey).parseClaimsJws(token).getBody().getExpiration()
					.before(new Date());
			// æ²¡æœ‰è¿‡æœŸï¼Œæœ‰æ•ˆï¼Œè¿”å›false
			return isExpire;
		} catch (Exception e) {
			// è¿‡æœŸå‡ºç°å¼‚å¸¸ï¼Œè¿”å›true
			return true;
		}
	}
}
```

### JSON è½¬æ¢çš„ WEBUtil å·¥å…·ç±»

```java
package com.atguigu.headline.util;

import java.io.BufferedReader;
import java.io.IOException;
import java.text.SimpleDateFormat;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.fasterxml.jackson.databind.ObjectMapper;

public class WebUtil {
	private static ObjectMapper objectMapper;
	
	// åˆå§‹åŒ–objectMapper
	static {
		objectMapper = new ObjectMapper();
		// è®¾ç½®JSONå’ŒObjectè½¬æ¢æ—¶çš„æ—¶é—´æ—¥æœŸæ ¼å¼
		objectMapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));
	}

	// ä»è¯·æ±‚ä¸­è·å–JSONä¸²å¹¶è½¬æ¢ä¸ºObject
	public static <T> T readJson(HttpServletRequest request, Class<T> clazz) {
		T t = null;
		BufferedReader reader = null;
		try {
			reader = request.getReader();
			StringBuffer buffer = new StringBuffer();
			String line = null;
			while ((line = reader.readLine()) != null) {
				buffer.append(line);
			}

			t = objectMapper.readValue(buffer.toString(), clazz);
		} catch (IOException e) {
			throw new RuntimeException(e);
		}
		return t;
	}

	// å°†Resultå¯¹è±¡è½¬æ¢æˆJSONä¸²å¹¶æ”¾å…¥å“åº”å¯¹è±¡
	public static void writeJson(HttpServletResponse response, Result result) {
		response.setContentType("application/json;charset=UTF-8");
		try {
			String json = objectMapper.writeValueAsString(result);
			response.getWriter().write(json);
		} catch (IOException e) {
			throw new RuntimeException(e);
		}
	}
}
```

## å‡†å¤‡å„å±‚çš„æ¥å£å’Œå®ç°ç±»

### å‡†å¤‡å®ä½“ç±»å’Œ VO å¯¹è±¡

**NewsUser**

```java
package com.atguigu.headline.pojo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;

@AllArgsConstructor
@NoArgsConstructor
@Data
public class NewsUser implements Serializable {
	private Integer uid;
	private String username;
	private String userPwd;
	private String nickName;
}
```

**NewsType**

```java
package com.atguigu.headline.pojo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;

@AllArgsConstructor
@NoArgsConstructor
@Data
public class NewsType implements Serializable {
	private Integer tid;
	private String tname;
}
```

**NewsHeadline**

```java
package com.atguigu.headline.pojo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;
import java.util.Date;

@AllArgsConstructor
@NoArgsConstructor
@Data
public class NewsHeadline implements Serializable {
	private Integer hid;
	private String title;
	private String article;
	private Integer type;
	private Integer publisher;
	private Integer pageViews;
	private Date createTime;
	private Date updateTime;
	private Integer isDeleted;
}
```

**HeadlineQueryVo**

```java
package com.atguigu.headline.pojo.vo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;

@AllArgsConstructor
@NoArgsConstructor
@Data
public class HeadlineQueryVo implements Serializable {
	private String keyWords;
	private Integer type;
	private Integer pageNum;
	private Integer pageSize;
}
```

**HeadlinePageVo**

```java
package com.atguigu.headline.pojo.vo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;

@AllArgsConstructor
@NoArgsConstructor
@Data
public class HeadlinePageVo implements Serializable {
	private Integer hid;
	private String title;
	private Integer type;
	private Integer pageViews;
	private Long pastHours;
	private Integer publisher;
}
```

**HeadlineDetailVo**

```java
package com.atguigu.headline.pojo.vo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;

@AllArgsConstructor
@NoArgsConstructor
@Data
public class HeadlineDetailVo implements Serializable {
	private Integer hid;
	private String title;
	private String article;
	private Integer type;
	private String typeName;
	private Integer pageViews;
	private Long pastHours;
	private Integer publisher;
	private String author;
}
```

### DAO å±‚æ¥å£å’Œå®ç°ç±»

> BaseDao åŸºç¡€ç±»ï¼Œå°è£…äº†å…¬å…±çš„æŸ¥è¯¢æ–¹æ³•å’Œå…¬å…±çš„å¢åˆ æ”¹æ–¹æ³•ï¼Œæ‰€æœ‰çš„ Dao æ¥å£çš„å®ç°ç±»éƒ½è¦ç»§æ‰¿BaseDaoã€‚

![1683354561889](images/1683354561889.png)

**BaseDao**

```java
package com.atguigu.headline.dao;

import com.atguigu.headline.util.JDBCUtil;
import java.lang.reflect.Field;
import java.sql.*;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;

public class BaseDao {
	// å…¬å…±çš„æŸ¥è¯¢æ–¹æ³• è¿”å›çš„æ˜¯å•ä¸ªå¯¹è±¡
	public <T> T baseQueryObject(Class<T> clazz, String sql, Object... args) {
		T t = null;
		Connection connection = JDBCUtil.getConnection();
		PreparedStatement preparedStatement = null;
		ResultSet resultSet = null;
		int rows = 0;
		try {
			// å‡†å¤‡è¯­å¥å¯¹è±¡
			preparedStatement = connection.prepareStatement(sql);
			// è®¾ç½®è¯­å¥ä¸Šçš„å‚æ•°
			for (int i = 0; i < args.length; i++) {
				preparedStatement.setObject(i + 1, args[i]);
			}

			// æ‰§è¡Œ æŸ¥è¯¢
			resultSet = preparedStatement.executeQuery();
			if (resultSet.next()) {
				t = (T) resultSet.getObject(1);
			}
		} catch (Exception e) {
			throw new RuntimeException(e);
		} finally {
			if (null != resultSet) {
				try {
					resultSet.close();
				} catch (SQLException e) {
					throw new RuntimeException(e);
				}
			}
			if (null != preparedStatement) {
				try {
					preparedStatement.close();
				} catch (SQLException e) {
					throw new RuntimeException(e);
				}
			}
			JDBCUtil.releaseConnection();
		}
		return t;
	}
	
	
	// å…¬å…±çš„æŸ¥è¯¢æ–¹æ³• è¿”å›çš„æ˜¯å¯¹è±¡çš„é›†åˆ
	public <T> List<T> baseQuery(Class clazz, String sql, Object... args) {
		List<T> list = new ArrayList<>();
		Connection connection = JDBCUtil.getConnection();
		PreparedStatement preparedStatement = null;
		ResultSet resultSet = null;
		int rows = 0;
		try {
			// å‡†å¤‡è¯­å¥å¯¹è±¡
			preparedStatement = connection.prepareStatement(sql);
			// è®¾ç½®è¯­å¥ä¸Šçš„å‚æ•°
			for (int i = 0; i < args.length; i++) {
				preparedStatement.setObject(i + 1, args[i]);
			}

			// æ‰§è¡Œ æŸ¥è¯¢
			resultSet = preparedStatement.executeQuery();

			ResultSetMetaData metaData = resultSet.getMetaData();
			int columnCount = metaData.getColumnCount();

			// å°†ç»“æœé›†é€šè¿‡åå°„å°è£…æˆå®ä½“ç±»å¯¹è±¡
			while (resultSet.next()) {
				// ä½¿ç”¨åå°„å®ä¾‹åŒ–å¯¹è±¡
				Object obj = clazz.getDeclaredConstructor().newInstance();

				for (int i = 1; i <= columnCount; i++) {
					String columnName = metaData.getColumnLabel(i);
					Object value = resultSet.getObject(columnName);
					// å¤„ç†datetimeç±»å‹å­—æ®µå’Œjava.util.Dataè½¬æ¢é—®é¢˜
					if (value.getClass().equals(LocalDateTime.class)) {
						value = Timestamp.valueOf((LocalDateTime) value);
					}
					Field field = clazz.getDeclaredField(columnName);
					field.setAccessible(true);
					field.set(obj, value);
				}
				list.add((T) obj);
			}
		} catch (Exception e) {
			throw new RuntimeException(e);
		} finally {
			if (null != resultSet) {
				try {
					resultSet.close();
				} catch (SQLException e) {
					throw new RuntimeException(e);
				}
			}
			if (null != preparedStatement) {
				try {
					preparedStatement.close();
				} catch (SQLException e) {
					throw new RuntimeException(e);
				}
			}
			JDBCUtil.releaseConnection();
		}
		return list;
	}

	
	// é€šç”¨çš„å¢åˆ æ”¹æ–¹æ³•
	public int baseUpdate(String sql, Object... args) {
		// è·å–è¿æ¥
		Connection connection = JDBCUtil.getConnection();
		PreparedStatement preparedStatement = null;
		int rows = 0;
		try {
			// å‡†å¤‡è¯­å¥å¯¹è±¡
			preparedStatement = connection.prepareStatement(sql);
			// è®¾ç½®è¯­å¥ä¸Šçš„å‚æ•°
			for (int i = 0; i < args.length; i++) {
				preparedStatement.setObject(i + 1, args[i]);
			}

			// æ‰§è¡Œ å¢åˆ æ”¹ executeUpdate
			rows = preparedStatement.executeUpdate();
			// é‡Šæ”¾èµ„æº(å¯é€‰)

		} catch (SQLException e) {
			throw new RuntimeException(e);
		} finally {
			if (null != preparedStatement) {
				try {
					preparedStatement.close();
				} catch (SQLException e) {
					throw new RuntimeException(e);
				}
			}
			JDBCUtil.releaseConnection();
		}
		// è¿”å›çš„æ˜¯å½±å“æ•°æ®åº“è®°å½•æ•°
		return rows;
	}
}
```

**dao å±‚çš„æ‰€æœ‰æ¥å£**

```java
package com.atguigu.headline.dao;

public interface NewsHeadLineDao {

}
```

```java
package com.atguigu.headline.dao;

public interface NewsTypeDao {

}
```

```java
package com.atguigu.headline.dao;

public interface NewsUserDao {

}
```

**dao å±‚æ‰€æœ‰å®ç°ç±»**

```java
package com.atguigu.headline.dao.impl;

import com.atguigu.headline.di{.aóeDAOJimfOò6"cmÍn`teuiwp>heedlinM.Lao.NE~sHeaflïfeDeo:‹*Pq2mkc`cl`ss(	eçSLuailo.eDcoKmàì(g}vEodS bc;eÄñ2m-²le-oôs$Neu{hei`Dine`go!)
¿Å*``@-
B`àêáò)PaÉk`gå0cmm.cv·u)÷U.heafline®`um.éM°l»

impwòt`#í-.atguíGulheallyne¤aoBaseD n:M
ampOpp0so}latgwicu>(eáthingôam.NgusT}peDao;$uâ`ic chcóc Nus41p}DafImpn wøu%&es áseDpo$mm0egme~4s Jes3qypeDaï`{mM@``L-ª```.éFaMŠpaójagç`cod~aVW}igu*hDatlafe.xáï+im`l;M
km@Oru0cï,.ctcuifm.e`fnK.g®fao.Â!eÅao;
lmpïrp Ko.i4gõ'unheaälknedai.NggóUsevDao;

pubmqâ,chasw Näw#Usg8aoMmpl"eht¥zD{ ÓãreTao im°<Åm%bts LagóÄsdrD!o {
*<
"p`Š	###!qMavi+e å±‚öŠ¥åÃõ’Œä®Úí°ç±;-ˆ![!68#34989r&3U8y-afes.16<7S14989r&3npşg)ÏJ
.ªògrvose à±Šç‰fœæ¡æ£**/)€`0zavã
tqc+ógeg?i4euiGu.h%a,l)nenr$tvi'e7
puÂLhs in4$vnáaq$LEwsHeatlxjaQWrrkge!ûM
}
``Dœ-`dĞjáwå
pa#kage ao=*`uouigu/hgadlinQ>÷mb6icE;	
ğ7"daC inteZnace La7s|xQe3ir6ice"M
}J```

`` Jaba
q`Cïage$cm.aÔcuioU.ie`älAn'.su÷rigm3Jpu`lik$intErfece(Nåws]cfpSedvhc% Zˆ
-õ
h@`Šª*sEr^éce å±‚æ‰€æœ‰å®ç°ç±»**

```java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.service.NewsHeadlineService;

public class NewsHeadlineServiceImpl implements NewsHeadlineService {

}
```

```java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.service.NewsTypeService;

public class NewsTypeServiceImpl implements NewsTypeService {

}
```

```java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.service.NewsUserService;

public class NewsUserServiceImpl implements NewsUserService {

}
```

### Controller å±‚æ¥å£å’Œå®ç°ç±»

> BaseController ç”¨äºå°†è·¯å¾„å…³è”åˆ°å¤„ç†æ–¹æ³•çš„åŸºç¡€æ§åˆ¶å™¨ï¼Œæ‰€æœ‰çš„ Controller éƒ½è¦ç»§æ‰¿è¯¥ç±»

**BaseController**

```java
package com.atguigu.headline.controller;


import java.io.IOException;
import java.lang.reflect.Method;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class BaseController extends HttpServlet {
	@Override
	protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		// å“åº”çš„MIMEç±»å‹å’Œä¹±ç é—®é¢˜
		resp.setContentType("application/json;charset=UTF-8");

		String requestURI = req.getRequestURI();
		String[] split = requestURI.split("/");
		String methodName = split[split.length - 1];
		// é€šè¿‡åå°„è·å–è¦æ‰§è¡Œçš„æ–¹æ³•
		Class clazz = this.getClass();
		try {
			Method method = clazz.getDeclaredMethod(methodName, HttpServletRequest.class, HttpServletResponse.class);
			// è®¾ç½®æ–¹æ³•å¯ä»¥è®¿é—®
			method.setAccessible(true);
			// é€šè¿‡åå°„æ‰§è¡Œä»£ç 
			method.invoke(this, req, resp);
		} catch (Exception e) {
			e.printStackTrace();
			throw new RuntimeException(e.getMessage());
		}
	}
}
```

**æ‰€æœ‰çš„ Controller ç±»**

```java
package com.atguigu.headline.controller;

import javax.servlet.annotation.WebServlet;

@WebServlet("/headline/*")
public class NewsHeadlineController extends BaseController {

}
```

```java
package com.atguigu.headline.controller;

import javax.servlet.annotation.WebServlet;

@WebServlet("/type/*")
public class NewsTypeController {

}
```

```java
package com.atguigu.headline.controller;

import javax.servlet.annotation.WebServlet;

@WebServlet("/user/*")
public class NewsUserController extends BaseController {

}
```

```java
package com.atguigu.headline.controller;

import javax.servlet.annotation.WebServlet;

@WebServlet("/portal/*")
public class PortalController extends BaseController {

}
```

## å¼€å‘è·¨åŸŸ CORS è¿‡æ»¤å™¨

### ä»€ä¹ˆæ˜¯è·¨åŸŸ

> åŒæºç­–ç•¥ï¼ˆSameoriginpolicyï¼‰æ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒä¹Ÿæœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼Œå¦‚æœç¼ºå°‘äº†åŒæºç­–ç•¥ï¼Œåˆ™æµè§ˆå™¨çš„æ­£å¸¸åŠŸèƒ½å¯èƒ½éƒ½ä¼šå—åˆ°å½±å“ã€‚å¯ä»¥è¯´ Web æ˜¯æ„å»ºåœ¨åŒæºç­–ç•¥åŸºç¡€ä¹‹ä¸Šçš„ï¼Œæµè§ˆå™¨åªæ˜¯é’ˆå¯¹åŒæºç­–ç•¥çš„ä¸€ç§å®ç°ã€‚**`åŒæºç­–ç•¥ä¼šé˜»æ­¢ä¸€ä¸ªåŸŸçš„javascriptè„šæœ¬å’Œå¦å¤–ä¸€ä¸ªåŸŸçš„å†…å®¹è¿›è¡Œäº¤äº’ã€‚æ‰€è°“åŒæºï¼ˆå³æŒ‡åœ¨åŒä¸€ä¸ªåŸŸï¼‰å°±æ˜¯ä¸¤ä¸ªé¡µé¢å…·æœ‰ç›¸åŒçš„åè®®ï¼ˆprotocolï¼‰ï¼Œä¸»æœºï¼ˆhostï¼‰å’Œç«¯å£å·`**

### ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè·¨åŸŸ

> å‰åç«¯åˆ†ç¦»æ¨¡å¼ä¸‹ï¼Œå®¢æˆ·ç«¯è¯·æ±‚å‰ç«¯æœåŠ¡å™¨è·å–è§†å›¾èµ„æºï¼Œç„¶åå®¢æˆ·ç«¯è‡ªè¡Œå‘åç«¯æœåŠ¡å™¨è·å–æ•°æ®èµ„æºï¼Œå‰ç«¯æœåŠ¡å™¨çš„åè®®ï¼ŒIP å’Œç«¯å£å’Œåç«¯æœåŠ¡å™¨å¾ˆå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™æ ·å°±äº§ç”Ÿäº†è·¨åŸŸã€‚

![1683364198087](images/1683364198087.png)

### å¦‚ä½•è§£å†³è·¨åŸŸ

**å‰ç«¯é¡¹ç›®ä»£ç†æ¨¡å¼å¤„ç†**

![1683365066926](images/1683365066926.png)

**åç«¯è·¨åŸŸè¿‡æ»¤å™¨æ–¹å¼å¤„ç†**

![1683364436315](images/1683364436315.png)

**CrosFilter è¿‡æ»¤å™¨**

```java
package com.atguigu.headline.filters;

import java.io.IOException;

import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.annotation.WebFilter;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebFilter("/*")
public class CrosFilter implements Filter {
	@Override
	public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)
			throws IOException, ServletException {
		HttpServletResponse response = (HttpServletResponse) servletResponse;
		HttpServletRequest request = (HttpServletRequest) servletRequest;
		response.setHeader("Access-Control-Allow-Origin", "*");
		response.setHeader("Access-Control-Allow-Methods", "POST, GET, OPTIONS, DELETE, HEAD");
		response.setHeader("Access-Control-Max-Age", "3600");
		response.setHeader("Access-Control-Allow-Headers",
				"access-control-allow-origin, authority, content-type, version-info, X-Requested-With");
		// éé¢„æ£€è¯·æ±‚,æ”¾è¡Œå³å¯,é¢„æ£€è¯·æ±‚,åˆ™åˆ°æ­¤ç»“æŸ,ä¸éœ€è¦æ”¾è¡Œ
		if (!request.getMethod().equalsIgnoreCase("OPTIONS")) {
			filterChain.doFilter(servletRequest, servletResponse);
		}
	}
}
```

> æœªæ¥æˆ‘ä»¬ä½¿ç”¨æ¡†æ¶ï¼Œç›´æ¥ç”¨ä¸€ä¸ª @CrossOrigin å°±å¯ä»¥è§£å†³è·¨åŸŸé—®é¢˜äº†

# PostMan æµ‹è¯•å·¥å…·

## ä»€ä¹ˆæ˜¯ PostMan

+  Postman æ˜¯ä¸€ä¸ª **`æ¥å£æµ‹è¯•å·¥å…·`**ï¼Œåœ¨åšæ¥å£æµ‹è¯•çš„æ—¶å€™ Postman ç›¸å½“äºä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå®ƒå¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·å‘èµ·çš„å„ç±» HTTP è¯·æ±‚ï¼Œå°†è¯·æ±‚æ•°æ®å‘é€è‡³æœåŠ¡ç«¯ï¼Œè·å–å¯¹åº”çš„å“åº”ç»“æœï¼Œä»è€ŒéªŒè¯å“åº”ä¸­çš„ç»“æœæ•°æ®æ˜¯å¦å’Œé¢„æœŸå€¼ç›¸åŒ¹é…ï¼›å¹¶ç¡®ä¿å¼€å‘äººå‘˜èƒ½å¤ŸåŠæ—¶å¤„ç†æ¥å£ä¸­çš„ bugï¼Œè¿›è€Œä¿è¯äº§å“ä¸Šçº¿ä¹‹åçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚ å®ƒä¸»è¦æ˜¯ç”¨æ¥æ¨¡æ‹Ÿå„ç§ HTTP è¯·æ±‚çš„(å¦‚ :getã€postã€deleteã€put...ç­‰ç­‰)ï¼ŒPostman ä¸æµè§ˆå™¨çš„åŒºåˆ«åœ¨äºæœ‰çš„æµè§ˆå™¨ä¸èƒ½è¾“å‡º Json æ ¼å¼ï¼Œè€Œ Postman æ›´ç›´è§‚æ¥å£è¿”å›çš„ç»“æœã€‚ 

## æ€ä¹ˆå®‰è£… PostMan

+ å®˜ç½‘ä¸‹è½½åœ°å€ : https://www.getpostman.com 
+ å®‰è£…è¿‡ç¨‹ç®€å•ï¼Œä¸€è·¯ next å³å¯
+ ç¬¬ä¸€æ¬¡å¯åŠ¨ Postman ä¼šè¦æ±‚è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå…³é—­ï¼Œå†æ¬¡å¯åŠ¨å°±å¯ä»¥ç›´æ¥è¿›å…¥äº† 

## æ€ä¹ˆä½¿ç”¨ PostMan

**å¯åŠ¨ PostMan åï¼Œåˆ›å»ºä¸€ä¸ª collectionï¼Œåœ¨è¯¥ collection ä¸‹ä¸“é—¨å­˜æ”¾å’Œå¾®å¤´æ¡é¡¹ç›®ç›¸å…³çš„æµ‹è¯•**

<img src="images/1683385255826.png" alt="1683385255826" style="zoom: 65%;" />

**åˆ›å»ºå®Œæ¯•åï¼Œå¢åŠ æ–°çš„æ¥å£æµ‹è¯•**

<img src="images/1683385333460.png" alt="1683385333460" style="zoom:50%;" />

**å¡«å†™è¦æµ‹è¯•çš„æ¥å£ç›¸å…³çš„è·¯å¾„ã€å‚æ•°ã€è¯·æ±‚ä½“å†…å®¹ç­‰ä¿¡æ¯**

<img src="images/1683385500897.png" alt="1683385500897" style="zoom:55%;" />

**æµ‹è¯•å®Œæ¯•åï¼Œå¯ä»¥é€‰æ‹©å°†è¯¥æ¥å£çš„æµ‹è¯•è¿›è¡Œä¿å­˜ï¼Œæ–¹ä¾¿åç»­éšæ—¶å†æ¬¡æµ‹è¯•**

<img src="images/1683385608824.png" alt="1683385608824" style="zoom:55%;" />

# ç™»å½•æ³¨å†ŒåŠŸèƒ½

## ç™»å½•è¡¨å•æäº¤

![1687657661761](images/1687657661761.png)

> éœ€æ±‚æè¿° : ç”¨æˆ·åœ¨å®¢æˆ·ç«¯è¾“å…¥ç”¨æˆ·åå¯†ç å¹¶å‘åç«¯æäº¤ï¼Œåç«¯æ ¹æ®ç”¨æˆ·åå’Œå¯†ç åˆ¤æ–­ç™»å½•æ˜¯å¦æˆåŠŸï¼Œç”¨æˆ·æœ‰è¯¯æˆ–è€…å¯†ç æœ‰è¯¯å“åº”ä¸åŒçš„æç¤ºä¿¡æ¯

**uri** 

``` http
/user/login
```

**è¯·æ±‚æ–¹å¼**

``` http
POST
```

**è¯·æ±‚å‚æ•°**

``` json
{
    "username":"zhangsan", //ç”¨æˆ·å
    "userPwd":"123456"     //æ˜æ–‡å¯†ç 
}
```

**ç™»å½•æˆåŠŸ**

``` json
{
    "code":"200",         // æˆåŠŸçŠ¶æ€ç  
 	"message":"success"   // æˆåŠŸçŠ¶æ€æè¿°
 	"data":{
		"token":"... ..." // ç”¨æˆ·idçš„token
	}
}
```

**ç”¨æˆ·åæœ‰è¯¯**

``` json
{
    "code":"501",
 	"message":"ç”¨æˆ·åæœ‰è¯¯"
 	"data":{}
}
```

**å¯†ç æœ‰è¯¯**

``` json
{
    "code":"503",
 	"message":"å¯†ç æœ‰è¯¯"
 	"data":{}
}
```

### å‰ç«¯ä»£ç¢¼

**pages/Login/index.vue**

```html
<template>
  <div class="login-container">
    <el-form :model="loginForm" ref="formRef" label-width="80px" class="login-form" :rules="loginRules">
      <h2>ç”¨æˆ·ç™»å½•</h2>
      <el-form-item label="ç”¨æˆ·å" prop="username">
        <el-input v-model="loginForm.username" ref="username" name="username" autocomplete="off"
          placeholder="è¯·è¾“å…¥ç”¨æˆ·å"></el-input>
      </el-form-item>
      <el-form-item label="å¯†ç " prop="userPwd">
        <el-input type="password" v-model="loginForm.userPwd" autocomplete="off" placeholder="è¯·è¾“å…¥å¯†ç "></el-input>
      </el-form-item>
      <el-form-item>
        <el-button type="success" @click.native.prevent="login">ç™»å½•</el-button>
        <el-button type="primary" @click="toRegister">æ³¨å†Œ</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>

<script lang="ts">
import { defineComponent } from 'vue'
export default defineComponent({
  name: 'Login'
})
</script>
<script lang="ts" setup>
import { ref } from "vue"
import { useUserInfoStore } from '../../stores/userInfo';
import type { FormInstance } from 'element-plus';
import { useRouter } from 'vue-router'

const userInfoStore = useUserInfoStore()
const router = useRouter()

const formRef = ref<FormInstance>()
const loading = ref(false)
//è´¦å·å¯†ç å‚æ•°
const loginForm = ref({
  username: "zhangsan",
  userPwd: "123456",
})

// æ ¡éªŒè§„åˆ™
const validateUsername = (rule: any, value: any, callback: any) => {
  if (value.length < 4) {
    callback(new Error('ç”¨æˆ·åé•¿åº¦ä¸èƒ½å°äº4ä½'))
  } else {
    callback()
  }
}

// æ ¡éªŒè§„åˆ™
const validatePassword = (rule: any, value: any, callback: any) => {
  if (value.length < 6) {
    callback(new Error('å¯†ç é•¿åº¦ä¸èƒ½å°äº6ä½'))
  } else {
    callback()
  }
}

// æ ¡éªŒè§„åˆ™
const loginRules = {
  username: [{ required: true, validator: validateUsername }],
  userPwd: [{ required: true, trigger: 'blur', validator: validatePassword }]
}

//ç‚¹å‡»ç™»å½•çš„å›è°ƒ
const login = async () => {
  await formRef.value?.validate()
  loading.value = true
  try {
    await userInfoStore.login(loginForm.value)
    router.push({ name: "HeadlineNews" });
  } finally {
    loading.value = false
  }
}

const toRegister = () => {
  router.push({ name: "Register" });
}
</script>

<style scoped lang="scss">
.login-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.login-form {
  width: 400px;
  text-align: center;
}
</style>
```

**stores/userInfo.js**

```javascript
import { defineStore } from 'pinia';
import { getToken, setToken } from '../utils/tokenUtils';
import { getLogin } from '../api/index';

/**
 * ç”¨æˆ·ä¿¡æ¯
 * @methods setUserInfos è®¾ç½®ç”¨æˆ·ä¿¡æ¯
 */
export const useUserInfoStore = defineStore('userInfo', {

  state: () => ({
    token: getToken()
  }),
  actions: {
    // ç™»é™†çš„å¼‚æ­¥action
    async login(loginForm) {
      // å‘é€ç™»é™†çš„è¯·æ±‚
      const result = await getLogin(loginForm)

      // è¯·æ±‚æˆåŠŸå, å–å‡ºtokenä¿å­˜  piniaå’Œlocalä¸­
      const token = result.token

      this.token = token

      setToken(token)
    }
  },
});
```

**utils/tokenUtils.ts**

```typescript
const TokenKey = 'vue_admin_template_token'

ex!òt`f5ncUkoo gåtuokon()!{	
 mzetuo`lKÓuìtnòawe.GEôAtem¨TocfNey	
{
:ex`osd!vµjsdcgn óAtTokmn(&kaî2 ótran'¨`  dgamCtgpawese4i4e}TokenK`y- 4oëun)
}

åxpgrP .tîÁvin^ paov%tieo- ?Š  lK#alwtkóqge¯Zçmnveitcm*PnIejÏey)	}L```FM
*zipo/in$dh*n	
``bji~aScbépÔ
)eqrt sea}wsp wBoi°".&-54ál3/reQqequ*	J
+oç™»ì½•çš¤ä¤å†ã
Ex`/bu KolstclrL.gmn \ inæO!&=¾([
` 2a|5rg€òepu!{t.0OóTh /usw2/oçin", a.fg);
}:
``d

kàŸ®ö•¹ `5Xiì2` ç‹¦ä½•ä¼‹ç-``r%qñeqt.jsp0æ–‡ä¾¶ª*
```nà6assziPT//$í·óå¼è¿·ä±ÒæŠ†æˆªå™¨	*seğviae.inpdrCePtkss.re1u}3t.wsd((ckNfig94-> {J* PpoOreSs>wtárT()n¯í­À ¯ê·›çè£æ¡J$3//å®†fæ‰0Okunn i –è¿'èï·æ1Âå¤¼f²ä¨¦ç»•çå°N!`c/~sT 5wErIlvoQtorá =±õReUó%pK.fgCtïrg(`imy!) // å'‚ä˜ô˜­öØ.m°¨ç»„ä«®æğ­ú0ƒç”((¥½…é¥»ä¼¤å…¥pk^he
0 {nlst"tn{un ½ }secÙjfoR¶Mr%.Tmkíî
  iæ {ke,(!:	
    c/nfyg®hæeldw7[#tKien'L `tnien* "}(! Råd5robonDiCûM
|)3
d  
J### å§¯Ä»£á¬H)+*NewsõPerCont2ml.ár+®

a`aje6a
páck#çe cïe.'uwuikwniua@lHe.Condro|ler;
JííportàjvA.on.HMExc$ptinF;
-Axort java.util.HashMap;
import java.util.Map;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.common.ResultCodeEnum;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.service.impl.NewsUserServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.MD5Util;
import com.atguigu.headline.util.WebUtil;

@WebServlet("/user/*")
public class NewsUserController extends BaseController {
	private NewsUserService newsUserService = new NewsUserServiceImpl();

	/**
	 * ç™»å½•éªŒè¯
	 * 
	 * @param req
	 * @param resp
	 * @throws ServletException
	 * @throws IOException
	 */
	protected void login(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		NewsUser newsUser = WebUtil.readJson(req, NewsUser.class);

		Result result = null;
		NewsUser loginNewsUser = newsUserService.findByUserName(newsUser.getUsername());
		// åˆ¤æ–­ç”¨æˆ·å
		if (null != loginNewsUser) {
			// åˆ¤æ–­å¯†ç 
			if (loginNewsUser.getUserPwd().equals(MD5Util.encrypt(newsUser.getUserPwd()))) {
				// å¯†ç æ­£ç¡®
				Map<String, Object> data = new HashMap<>();
				// ç”Ÿæˆtokenå£ä»¤
				String token = JwtHelper.createToken(loginNewsUser.getUid().longValue());
				// å°è£…æ•°æ®map
				data.put("token", token);
				// å°è£…ç»“æœ
				result = Result.ok(data);
			} else {
				// å°è£…å¯†ç é”™è¯¯ç»“æœ
				result = Result.build(null, ResultCodeEnum.PASSWORD_ERROR);
			}
		} else {
			// å°è£…ç”¨æˆ·åé”™è¯¯ç»“æœ
			result = Result.build(null, ResultCodeEnum.USERNAME_ERROR);
		}
		// å“åº”ç»“æœ
		WebUtil.writeJson(resp, result);
	}
}
```

**NewsUserService**

```java
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsUser;

public interface NewsUserService {
	/**
	 * æ ¹æ®ç”¨æˆ·å,è·å¾—æŸ¥è¯¢ç”¨æˆ·çš„æ–¹æ³•
	 * 
	 * @param username è¦æŸ¥è¯¢çš„ç”¨æˆ·å
	 * @return å¦‚æœæ‰¾åˆ°è¿”å›NewsUserå¯¹è±¡,æ‰¾ä¸åˆ°è¿”å›null
	 */
	NewsUser findByUserName(String username);
}
```

**NewsUserServiceImpl**

```java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.dao.impl.NewsUserDaoImpl;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;

public class NewsUserServiceImpl implements NewsUserService {
	private NewsUserDao newsUserDao = new NewsUserDaoImpl();

	@Override
	public NewsUser findByUserName(String username) {
		return newsUserDao.findByUserName(username);
	}
}
```

**NewUserDao**

```java
package com.atguigu.headline.dao;

import com.atguigu.headline.pojo.NewsUser;

public interface NewsUserDao {
	/**
	 * æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
	 * 
	 * @param username è¦æŸ¥è¯¢çš„ç”¨æˆ·å
	 * @return æ‰¾åˆ°è¿”å›NewsUserå¯¹è±¡,æ‰¾ä¸åˆ°è¿”å›null
	 */
	NewsUser findByUserName(String username);
}
```

**NewsUserDaoImpl**

```java
package com.atguigu.headline.dao.impl;

import java.util.List;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.pojo.NewsUser;

public class NewsUserDaoImpl extends BaseDao implements NewsUserDao {
	@Override
	public NewsUser findByUserName(String username) {
		// å‡†å¤‡SQL
		String sql = "select uid,username,user_pwd userPwd ,nick_name nickName from news_user where username = ?";
		// è°ƒç”¨BaseDaoå…¬å…±æŸ¥è¯¢æ–¹æ³•
		List<NewsUser> newsUserList = baseQuery(NewsUser.class, sql, username);
		// å¦‚æœæ‰¾åˆ°,è¿”å›é›†åˆä¸­çš„ç¬¬ä¸€ä¸ªæ•°æ®(å…¶å®å°±ä¸€ä¸ª)
		if (null != newsUserList && newsUserList.size() > 0) {
			return newsUserList.get(0);
		}
		return null;
	}
}
```

## æ ¹æ® token è·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯

> éœ€æ±‚æè¿° : å®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼Œæäº¤ token è¯·æ±‚å¤´ï¼Œåç«¯æ ¹æ® token è¯·æ±‚å¤´è·å–ç™»å½•ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯å¹¶å“åº”ç»™å®¢æˆ·ç«¯è¿›è¡Œå­˜å‚¨

**uri**

``` http
/user/getUserInfo
```

**è¯·æ±‚æ–¹å¼**

``` http
GET
```

**è¯·æ±‚å¤´**

``` json
token: ... ...
```

**æˆåŠŸè·å–**

``` JSON
{
    "code": 200,
    "message": "success",
    "data": {
        "loginUser": {
            "uid": 1,
            "username": "zhangsan",
            "userPwd": "",
            "nickName": "å¼ ä¸‰"
        }
    }
}
```

**è·å–å¤±è´¥**

``` json
{
    "code": 504,
    "message": "notLogin",
    "data": null
}
```

### å‰ç«¯ä»£ç¢¼

**stores/userInfo.js**

```javascript
import { defineStore } from 'pinia';
import { getUserInfo } from '../api/index';

// ç”¨æˆ·ä¿¡æ¯
export const useUserInfoStore = defineStore('userInfo', {
  state: () => ({
    nickName: '',
    uid: '',
  }),
  actions: {
    async getInfo () {
      const result = await getUserInfo()
      this.nickName = result.loginUser.nickName
      this.uid = result.loginUser.uid
    },
  },
});
```

**api/index**

```javascript
import request from "../utils/request"

//è·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£
export const getUserInfo = (info) => {
  return request.get("/user/getUserInfo");
};
```

### åç«¯ä»£ç 

**NewsUserController**

```java
package com.atguigu.headline.controller;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.common.ResultCodeEnum;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.service.impl.NewsUserServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.MD5Util;
import com.atguigu.headline.util.WebUtil;

@WebServlet("/user/*")
public class NewsUserController extends BaseController {
	private NewsUserService newsUserService = new NewsUserServiceImpl();

	/**
	 * æ¥æ”¶token,æ ¹æ®tokenæŸ¥è¯¢å®Œæ•´ç”¨æˆ·ä¿¡æ¯
	 * 
	 * @param req
	 * @param resp
	 * @throws ServletException
	 * @throws IOException
	 */
	protected void getUserInfo(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		String token = req.getHeader("token");
		Result result = Result.build(null, ResultCodeEnum.NOTLOGIN);
		if (null != token) {
			if (!JwtHelper.isExpiration(token)) {
				Integer uid = JwtHelper.getUserId(token).intValue();
				NewsUser newsUser = newsUserService.findByUid(uid);
				newsUser.setUserPwd("");
				Map<String, Object> data = new HashMap<>();
				data.put("loginUser", newsUser);
				result = Result.ok(data);
			}
		}
		WebUtil.writeJson(resp, result);
	}
}
```

**NewsUserService**

```java
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsUser;

public interface NewsUserService {
	/**
	 * æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
	 * 
	 * @param uid è¦æŸ¥è¯¢çš„ç”¨æˆ·id
	 * @return æ‰¾åˆ°è¿”å›NewsUserå¯¹è±¡,æ‰¾ä¸åˆ°è¿”å›null
	 */
	NewsUser findByUid(Integer uid);
}
```

**NewsUserServiceImpl**

```java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.dao.impl.NewsUserDaoImpl;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;

public class NewsUserServiceImpl implements NewsUserService {
	private NewsUserDao newsUserDao = new NewsUserDaoImpl();
	
    @Override
    public NewsUser findByUid(Integer uid) {
        return newsUserDao.findByUid(uid);
    }
}
```

**NewUserDao**

```java
package com.atguigu.headline.dao;

import com.atguigu.headline.pojo.NewsUser;

public interface NewsUserDao {
	/**
	 * æ ¹æ®ç”¨æˆ·idè¿æ¥æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
	 * 
	 * @param uid è¦æŸ¥è¯¢çš„ç”¨æˆ·id
	 * @return æ‰¾åˆ°è¿”å›NewsUserå¯¹è±¡,æ‰¾ä¸åˆ°è¿”å›null
	 */
	NewsUser findByUid(Integer uid);
}
```

**NewUserDaoImpl**

```java
package com.atguigu.headline.dao.impl;

import java.util.List;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.pojo.NewsUser;

public class NewsUserDaoImpl extends BaseDao implements NewsUserDao {
	@Override
	public NewsUser findByUid(Integer uid) {
		String sql = "select uid,username,user_pwd userPwd ,nick_name nickName from news_user where uid = ?";
		List<NewsUser> newsUserList = baseQuery(NewsUser.class, sql, uid);
		if (null != newsUserList && newsUserList.size() > 0) {
			return newsUserList.get(0);
		}
		return null;
	}
}
```

## æ³¨å†Œæ—¶ç”¨æˆ·åå ç”¨æ ¡éªŒ

<img src="images/checkuserName.gif" alt="checkuserName" style="zoom:60%;" />

> éœ€æ±‚è¯´æ˜ : ç”¨æˆ·åœ¨æ³¨å†Œæ—¶è¾“å…¥ç”¨æˆ·åæ—¶ï¼Œç«‹åˆ»å°†ç”¨æˆ·åå‘é€ç»™åç«¯ï¼Œåç«¯æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·åæ˜¯å¦å¯ç”¨å¹¶åšå‡ºå“åº”

**uri**

``` http
/user/checkUserName
```

**è¯·æ±‚æ–¹å¼**

``` http
POST
```

**è¯·æ±‚å‚æ•°**

``` json
username=zhangsan
```

**ç”¨æˆ·åæ ¡éªŒé€šè¿‡**

``` json
{
    "code":"200",
 	"message":"success"
 	"data":{}
}
```

**ç”¨æˆ·åå ç”¨**

``` json
{
    "code":"505",
 	"message":"ç”¨æˆ·åå ç”¨"
 	"data":{}
}
```

### åç«¯ä»£ç 

**NewsUserController**

```java
package com.atguigu.headline.controller;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.common.ResultCodeEnum;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.service.impl.NewsUserServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.MD5Util;
import com.atguigu.headline.util.WebUtil;

@WebServlet("/user/*")
public class NewsUserController extends BaseController {
	private NewsUserService newsUserService = new NewsUserServiceImpl();

	/**
	 * æ³¨å†Œæ—¶æ ¡éªŒç”¨æˆ·åæ˜¯å¦è¢«å ç”¨
	 * 
	 * @param req
	 * @param resp
	 * @throws ServletException
	 * @throws IOException
	 */
	protected void checkUserName(HttpServletRequest req, HttpServletResponse resp)
			throws ServletException, IOException {
		String username = req.getParameter("username");
		NewsUser newsUser = newsUserService.findByUserName(username);
		Result result = null;
		if (null == newsUser) {
			result = Result.ok(null);
		} else {
			result = Result.build(null, ResultCodeEnum.USERNAME_USED);
		}
		WebUtil.writeJson(resp, result);
	}
}
```

**NewsUserService**

```java
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsUser;

public interface NewsUserService {
	/**
	 * æ ¹æ®ç”¨æˆ·å,è·å¾—æŸ¥è¯¢ç”¨æˆ·çš„æ–¹æ³•
	 * 
	 * @param username è¦æŸ¥è¯¢çš„ç”¨æˆ·å
	 * @return å¦‚æœæ‰¾åˆ°è¿”å›NewsUserå¯¹è±¡,æ‰¾ä¸åˆ°è¿”å›null
	 */
	NewsUser findByUserName(String username);
}
```

**NewsUserServiceImpl**

```java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.dao.impl.NewsUserDaoImpl;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;

public class NewsUserServiceImpl implements NewsUserService {
	private NewsUserDao newsUserDao = new NewsUserDaoImpl();

	@Override
	public NewsUser findByUserName(String username) {
		return newsUserDao.findByUserName(username);
	}
}
```

**NewUserDao**

```java
package com.atguigu.headline.dao;

import com.atguigu.headline.pojo.NewsUser;

public interface NewsUserDao {
	/**
	 * æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
	 * 
	 * @param username è¦æŸ¥è¯¢çš„ç”¨æˆ·å
	 * @return æ‰¾åˆ°è¿”å›NewsUserå¯¹è±¡,æ‰¾ä¸åˆ°è¿”å›null
	 */
	NewsUser findByUserName(String username);
}
```

**NewsUserDaoImpl**

```java
package com.atguigu.headline.dao.impl;

import java.util.List;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.pojo.NewsUser;

public class NewsUserDaoImpl extends BaseDao implements NewsUserDao {
	@Override
	public NewsUser findByUserName(String username) {
		// å‡†å¤‡SQL
		String sql = "select uid,username,user_pwd userPwd ,nick_name nickName from news_user where username = ?";
		// è°ƒç”¨BaseDaoå…¬å…±æŸ¥è¯¢æ–¹æ³•
		List<NewsUser> newsUserList = baseQuery(NewsUser.class, sql, username);
		// å¦‚æœæ‰¾åˆ°,è¿”å›é›†åˆä¸­çš„ç¬¬ä¸€ä¸ªæ•°æ®(å…¶å®å°±ä¸€ä¸ª)
		if (null != newsUserList && newsUserList.size() > 0) {
			return newsUserList.get(0);
		}
		return null;
	}
}
```

## æ³¨å†Œè¡¨å•æäº¤

<img src="images/regist.gif" alt="regist" style="zoom:60%;" />

> éœ€æ±‚è¯´æ˜ : å®¢æˆ·ç«¯å°†æ–°ç”¨æˆ·ä¿¡æ¯å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å°†æ–°ç”¨æˆ·å­˜å…¥æ•°æ®åº“ï¼Œå­˜å…¥ä¹‹å‰åšç”¨æˆ·åæ˜¯å¦è¢«å ç”¨æ ¡éªŒï¼Œæ ¡éªŒé€šè¿‡å“åº”æˆåŠŸæç¤ºï¼Œå¦åˆ™å“åº”å¤±è´¥æç¤º

**uri**

``` http
/user/regist
```

**è¯·æ±‚æ–¹å¼**

``` http
POST
```

**è¯·æ±‚å‚æ•°**

``` json
{
    "username":"zhangsan",
    "userPwd":"123456",
    "nickName":"å¼ ä¸‰"
}
```

**æ³¨å†ŒæˆåŠŸ**

``` json
{
    "code":"200",
 	"message":"success"
 	"data":{}
}
```

**ç”¨æˆ·åå ç”¨**

``` json
{
    "code":"505",
 	"message":"ç”¨æˆ·åå ç”¨"
 	"data":{}
}
```

### å‰ç«¯ä»£ç¢¼

**pages/Register/index.vue**

```html
<script lang="ts" setup>
import { ref } from "vue";
import type { FormInstance } from 'element-plus';
import { useRouter } from 'vue-router'
import { ElMessage } from 'element-plus';
import { registerValidateApi, registerApi } from "../../api/index"

const router = useRouter()

// åˆå§‹åŒ–æ³¨å†Œå‚æ•°
const registerForm = ref({
  username: "",
  userPwd: "",
  confirmPassword: "",
  nickName: ''
})

const formRef = ref<FormInstance>()

// æ ¡éªŒè§„åˆ™
const validateNickName = (rule: any, value: any, callback: any) => {
  if (value.length >= 2 && value.length <= 6) {
    callback()
  } else {
    callback(new Error('å§“åå¿…é¡»åœ¨2-6ä½'))
  }
}

// æ ¡éªŒè§„åˆ™
const validateUsername = (rule: any, value: any, callback: any) => {
  if (value.length < 4) {
    callback(new Error('ç”¨æˆ·åé•¿åº¦ä¸èƒ½å°äº4ä½'))
  } else {
    callback()
  }
}

// æ ¡éªŒè§„åˆ™
const validatePassword = (rule: any, value: any, callback: any) => {
  if (value.length < 6) {
    callback(new Error('å¯†ç é•¿åº¦ä¸èƒ½å°äº6ä½'))
  } else {
    callback()
  }
}

// æ ¡éªŒè§„åˆ™
const validateConfirmPassword = (rule: any, value: any, callback: any) => {
  if (value.length < 6) {
    callback(new Error('å¯†ç é•¿åº¦ä¸èƒ½å°äº6ä½'))
  } else {
    callback()
  }
}

// æ ¡éªŒè§„åˆ™
const registerRules = {
  nickName: [{ required: true, trigger: 'blur', validator: validateNickName }],
  username: [{ required: true, validator: validateUsername }],
  userPwd: [{ required: true, trigger: 'blur', validator: validatePassword }],
  confirmPassword: [{ required: true, trigger: 'blur', validator: validateConfirmPassword }]
}

//ç‚¹å‡»æ³¨å†Œçš„å›è°ƒ
const register = async () => {
  await formRef.value?.validate()
  if (registerForm.value.userPwd == registerForm.value.confirmPassword) {
    // è°ƒç”¨ç”¨æˆ·åæ ¡éªŒæ¥å£
    await registerValidateApi(registerForm.value.username)
    //  æ•´ç†å‚æ•°
    const obj = {
      username: "",
      userPwd: "",
      nickName: ''
    }
    obj.username = registerForm.value.username
    obj.userPwd = registerForm.value.userPwd
    obj.nickName = registerForm.value.nickName
    //  è°ƒç”¨æ³¨å†Œæ¥å£
    await registerApi(obj)
    formRef.value?.resetFields()
    ElMessage.success("æ³¨å†ŒæˆåŠŸ")
  } else {
    return ElMessage.error("å¯†ç å’Œç¡®å®šå¯†ç å¿…é¡»ä¸€è‡´")
  }
}

//ç‚¹å‡»å»ç™»å½•çš„å›è°ƒ
const goLogin = () => {
  router.push({ path: "/login" })
}

//ç‚¹å‡»é‡ç½®çš„å›è°ƒ
const resetForm = () => {
  //é‡ç½®è¡¨å•
  formRef.value?.resetFields()
}
</script>

<template>
  <div class="register-container">
    <el-form :model="registerForm" ref="formRef" label-width="80px" class="register-form" :rules="registerRules">
      <h2>ç”¨æˆ·æ³¨å†Œ</h2>
      <el-form-item label="å§“å" prop="nickName">
        <el-input v-model="registerForm.nickName" autocomplete="off" name="nickName" placeholder="è¯·è¾“å…¥å§“å" />
      </el-form-item>

      <el-form-item label="ç”¨æˆ·å" prop="username">
        <el-input v-model="registerForm.username" autocomplete="off" name="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" />
      </el-form-item>

      <el-form-item label="å¯†ç " prop="userPwd">
        <el-input type="password" v-model="registerForm.userPwd" name="userPwd" autocomplete="off"
          placeholder="è¯·è¾“å…¥å¯†ç " />
      </el-form-item>

      <el-form-item label="ç¡®è®¤å¯†ç " prop="confirmPassword">
        <el-input type="password" v-model="registerForm.confirmPassword" autocomplete="off" name="confirmPassword"
          placeholder="è¯·ç¡®è®¤å¯†ç " />
      </el-form-item>

      <el-form-item>
        <el-button type="primary" @click="register">æ³¨å†Œ</el-button>
        <el-button type="danger" @click="resetForm">é‡ç½®</el-button>
        <el-button type="success" @click="goLogin">å»ç™»å½•</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>

<style scoped lang="scss">
.register-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.register-form {
  width: 400px;
  text-align: center;
}
</style>
```

**api/index**

```javascript
import request from "../utils/request"

//æ³¨å†Œæ ¡éªŒçš„æ¥å£  user/checkUserName
export const registerValidateApi = (username) => {
  return request({
    method: "post",
    url: "user/checkUserName",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded;charset=utf-8",
    },
    data: `username=${username}`
  })
};

// æ³¨å†Œçš„æ¥å£
export const registerApi = (userInfo) => {
  return request.post("/user/regist", userInfo)
}
```

### åç«¯ä»£ç 

**NewsUserController**

```java
package com.atguigu.headline.controller;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.common.ResultCodeEnum;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.service.impl.NewsUserServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.MD5Util;
import com.atguigu.headline.util.WebUtil;

@WebServlet("/user/*")
public class NewsUserController extends BaseController {
	private NewsUserService newsUserService = new NewsUserServiceImpl();

	/**
	 * æ³¨å†ŒåŠŸèƒ½æ¥å£
	 * 
	 * @param req
	 * @param resp
	 * @throws ServletException
	 * @throws IOException
	 */
	protected void regist(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		NewsUser newsUser = WebUtil.readJson(req, NewsUser.class);
		NewsUser usedUser = newsUserService.findByUserName(newsUser.getUsername());
		Result result = null;
		if (null == usedUser) {
			newsUserService.registUser(newsUser);
			result = Result.ok(null);
		} else {
			result = Result.build(null, ResultCodeEnum.USERNAME_USED);
		}
		WebUtil.writeJson(resp, result);
	}
}
```

**NewsUserService**

```java
package com.atguigu.headline.service;

import com.atguigu.headline.pojo.NewsUser;

public interface NewsUserService {
	/**
	 * æ³¨å†Œç”¨æˆ·ä¿¡æ¯,æ³¨å†ŒæˆåŠŸè¿”å›å¤§äº0çš„æ•´æ•°,å¤±è´¥è¿”å›0
	 * 
	 * @param newsUser
	 * @return
	 */
	int registUser(NewsUser newsUser);
}
```

**NewsUserServiceImpl**

```java
package com.atguigu.headline.service.impl;

import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.dao.impl.NewsUserDaoImpl;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.util.MD5Util;

public class NewsUserServiceImpl implements NewsUserService {
	private NewsUserDao newsUserDao = new NewsUserDaoImpl();
    
	@Override
	public int registUser(NewsUser newsUser) {
		// å¯†ç æ˜æ–‡è½¬å¯†æ–‡
		newsUser.setUserPwd(MD5Util.encrypt(newsUser.getUserPwd()));
		// å­˜å…¥æ•°æ®åº“
		return newsUserDao.insertNewsUser(newsUser);
	}
}
```

**NewUserDao**

```java
package com.atguigu.headline.dao;

import com.atguigu.headline.pojo.NewsUser;

public interface NewsUserDao {
	/**
	 * å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥æ•°æ®åº“
	 * 
	 * @param newsUser
	 * @return
	 */
	int insertNewsUser(NewsUser newsUser);
}
```

**NewUserDaoImpl**

```java
package com.atguigu.headline.dao.impl;

import java.util.List;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsUserDao;
import com.atguigu.headline.pojo.NewsUser;

public class NewsUserDaoImpl extends BaseDao implements NewsUserDao {
	@Override
	public int insertNewsUser(NewsUser newsUser) {
		String sql = "insert into news_user values(DEFAULT,?,?,?)";
		return baseUpdate(sql, newsUser.getUsername(), newsUser.getUserPwd(), newsUser.getNickName());
	}
}
```

## è¨­ç½®å…¨å±€è·¯ç”±å®ˆè¡›

**src/router/index.js**

```javascript
//å…¨å±€å‰ç½®å®ˆå«
router.beforeEach(async (to, from, next) => {
  const token = getToken()
  const userInfo = !!userInfoStore.nickName
  if (token) {
    if (to.path == "/login") {
      next({ path: "/" })
    } else {
      if (userInfo) {
        next()
      } else {
        try {
          await userInfoStore.getInfo()
          next()
        } catch (error) {
          removeToken()
        }
      }
    }
  } else {
    next()
  }
});
```

# å¤´æ¡é¦–é¡µåŠŸèƒ½

## æŸ¥è¯¢æ‰€æœ‰å¤´æ¡åˆ†ç±»

![1684890693363](images/1684890693363.png)

> éœ€æ±‚è¯´æ˜ : è¿›å…¥æ–°é—»é¦–é¡µï¼ŒæŸ¥è¯¢æ‰€æœ‰åˆ†ç±»å¹¶åŠ¨æ€å±•ç¤ºæ–°é—»ç±»åˆ«æ ä½

**uri**

``` http
/portal/findAllTypes
```

**è¯·æ±‚æ–¹å¼**

``` http
GET
```

**è¯·æ±‚å‚æ•°**

``` JSON
æ— 
```

**å“åº”ç¤ºä¾‹**

``` JSON
{
    "code":"200",
 	"message":"OK"
 	"data":
            [
                {
                    "tid":"1",
                    "tname":"æ–°é—»"
                },
                {
                    "tid":"2",
                    "tname":"ä½“è‚²"
                },
                {
                    "tid":"3",
                    "tname":"å¨±ä¹"
                },
                {
                    "tid":"4",
                    "tname":"ç§‘æŠ€"
                },
                {
                    "tid":"5",
                    "tname":"å…¶ä»–"
                }
            ]   
}
```

### åç«¯ä»£ç 

**PortalController**

```java
package com.atguigu.headline.controller;

import java.io.IOException;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsType;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.NewsTypeService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.service.impl.NewsTypeServiceImpl;
import com.atguigu.headline.util.WebUtil;

@WebServlet("/portal/*")
public class PortalController extends BaseController {
	private NewsHeadlineService headlineService = new NewsHeadlineServiceImpl();
	private NewsTypeService newsTypeService = new NewsTypeServiceImpl();

	/**
	 * æŸ¥è¯¢æ‰€æœ‰æ–°é—»ç±»å‹
	 * 
	 * @param req
	 * @param resp
	 * @throws ServletException
	 * @throws IOException
	 */
	protected void findAllTypes(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		List<NewsType> newsTypeList = newsTypeService.findAll();
		WebUtil.writeJson(resp, Result.ok(newsTypeList));
	}
}
```

**NewsTypeService**

```java
package com.atguigu.headline.service;

import java.util.List;

import com.atguigu.headline.pojo.NewsType;

public interface NewsTypeService {
	/**
	 * æŸ¥è¯¢å…¨éƒ¨æ–°é—»ç±»å‹
	 * 
	 * @return
	 */
	List<NewsType> findAll();
}
```

**NewsTypeServiceImpl**

```java
package com.atguigu.headline.service.impl;

import java.util.List;

import com.atguigu.headline.dao.NewsTypeDao;
import com.atguigu.headline.dao.impl.NewsTypeDaoImpl;
import com.atguigu.headline.pojo.NewsType;
import com.atguigu.headline.service.NewsTypeService;

public class NewsTypeServiceImpl implements NewsTypeService {
	private NewsTypeDao newsTypeDao = new NewsTypeDaoImpl();

	@Override
	public List<NewsType> findAll() {
		return newsTypeDao.findAll();
	}
}
```

**NewUserDao**

```java
package com.atguigu.headline.dao;

import java.util.List;

import com.atguigu.headline.pojo.NewsType;

public interface NewsTypeDao {
	/**
	 * ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å…¨éƒ¨æ–°é—»ç±»å‹
	 * 
	 * @return
	 */
	List<NewsType> findAll();
}
```

**NewsTypeDaoImpl**

```java
package com.atguigu.headline.dao.impl;

import java.util.List;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsTypeDao;
import com.atguigu.headline.pojo.NewsType;

public class NewsTypeDaoImpl extends BaseDao implements NewsTypeDao {
	@Override
	public List<NewsType> findAll() {
		String sql = "select tid,tname from news_type";
		return baseQuery(NewsType.class, sql);
	}
}
```

## åˆ†é¡µå¸¦æ¡ä»¶æŸ¥è¯¢æ‰€æœ‰å¤´æ¡

![1684890943094](images/1684890943094.png)

> éœ€æ±‚è¯´æ˜
>
> - å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€æŸ¥è¯¢å…³é”®å­—ã€æ–°é—»ç±»åˆ«ã€é¡µç æ•°ã€é¡µå¤§å°
> - æœåŠ¡ç«¯æ ¹æ®æ¡ä»¶æœç´¢åˆ†é¡µä¿¡æ¯ï¼Œè¿”å›å«é¡µç æ•°ã€é¡µå¤§å°ã€æ€»é¡µæ•°ã€æ€»è®°å½•æ•°ã€å½“å‰é¡µæ•°æ®ç­‰ä¿¡æ¯ï¼Œå¹¶æ ¹æ®æ—¶é—´é™åºï¼Œæµè§ˆé‡é™åºæ’åº

**uri**

``` http
/portal/findNewsPage
```

**è¯·æ±‚æ–¹å¼**

``` http
POST
```

**è¯·æ±‚å‚æ•°**

``` json
{
    "keyWords":"é©¬æ–¯å…‹", // æœç´¢æ ‡é¢˜å…³é”®å­—
    "type":0,           // æ–°é—»ç±»å‹
    "pageNum":1,        // é¡µç æ•°
    "pageSize":"10"     // é¡µå¤§å°
}
```

**å“åº”ç¤ºä¾‹**

``` json
{
    "code":"200",
 	"message":"success"
 	"data":{
    	"pageInfo":{
    		"pageData":[                           // æœ¬é¡µçš„æ•°æ®
    			{
    				"hid":"1",                     // æ–°é—»id 
    				"title":"å°šç¡…è°·å®£å¸ƒ ... ...",   // æ–°é—»æ ‡é¢˜
    				"type":"1",                    // æ–°é—»æ‰€å±ç±»åˆ«ç¼–å·
    				"pageViews":"40",              // æ–°é—»æµè§ˆé‡
    				"pastHours":"3" ,              // å‘å¸ƒæ—¶é—´å·²è¿‡å°æ—¶æ•°
    				"publisher":"1"                // å‘å¸ƒç”¨æˆ·ID
				},
				{
    				"hid":"1",                     // æ–°é—»id 
    				"title":"å°šç¡…è°·å®£å¸ƒ ... ...",   // æ–°é—»æ ‡é¢˜
    				"type":"1",                    // æ–°é—»æ‰€å±ç±»åˆ«ç¼–å·
    				"pageViews":"40",              // æ–°é—»æµè§ˆé‡
    				"pastHours":"3",              // å‘å¸ƒæ—¶é—´å·²è¿‡å°æ—¶æ•°
    				"publisher":"1"                // å‘å¸ƒç”¨æˆ·ID
				},
				{
    				"hid":"1",                     // æ–°é—»id 
    				"title":"å°šç¡…è°·å®£å¸ƒ ... ...",   // æ–°é—»æ ‡é¢˜
    				"type":"1",                    // æ–°é—»æ‰€å±ç±»åˆ«ç¼–å·
    				"pageViews":"40",              // æ–°é—»æµè§ˆé‡
    				"pastHours":"3",               // å‘å¸ƒæ—¶é—´å·²è¿‡å°æ—¶æ•°
    				"publisher":"1"                // å‘å¸ƒç”¨æˆ·ID
				}
    		],
			"pageNum":1,    //é¡µç æ•°
			"pageSize":10,  // é¡µå¤§å°
			"totalPage":20, // æ€»é¡µæ•°
			"totalSize":200 // æ€»è®°å½•æ•°
		}
	}
}
```

### åç«¯ä»£ç 

**PortalController**

```java
package com.atguigu.headline.controller;

import java.io.IOException;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsType;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.NewsTypeService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.service.impl.NewsTypeServiceImpl;
import com.atguigu.headline.util.WebUtil;

@WebServlet("/portal/*")
public class PortalController extends BaseController {
	private NewsHeadlineService headlineService = new NewsHeadlineServiceImpl();
	private NewsTypeService newsTypeService = new NewsTypeServiceImpl();

	/**
	 * åˆ†é¡µå¸¦æ¡ä»¶æŸ¥è¯¢æ–°é—»
	 * 
	 * @param req
	 * @param resp
	 * @throws ServletException
	 * @throws IOException
	 */
	protected void findNewsPage(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		HeadlineQueryVo headLineQueryVo = WebUtil.readJson(req, HeadlineQueryVo.class);
		// æŸ¥è¯¢åˆ†é¡µäº”é¡¹æ•°æ®
		Map<String, Object> pageInfo = headlineService.findPage(headLineQueryVo);
		// å°†åˆ†é¡µäº”é¡¹æ•°æ®æ”¾å…¥PageInfoMap
		Map<String, Object> pageInfoMap = new HashMap<>();
		pageInfoMap.put("pageInfo", pageInfo);
		// å“åº”JSON
		WebUtil.writeJson(resp, Result.ok(pageInfoMap));
	}
}
```

**NewsHeadlineService**

```java
package com.atguigu.headline.service;

import java.util.Map;

import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public interface NewsHeadlineService {
	/**
	 * åˆ†é¡µæŸ¥è¯¢å¤´æ¡æ–°é—»æ–¹æ³•
	 * 
	 * @param headLineQueryVo
	 * @return
	 */
	Map<String, Object> findPage(HeadlineQueryVo headLineQueryVo);
}
```

**NewsHeadlineServiceImpl**

```java
package com.atguigu.headline.service.impl;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;

public class NewsHeadlineServiceImpl implements NewsHeadlineService {
	private NewsHeadLineDao newsHeadLineDao = new NewsHeadlineDaoImpl();

	@Override
	public Map<String, Object> findPage(HeadlineQueryVo headLineQueryVo) {
		// å‡†å¤‡ä¸€ä¸ªmap,ç”¨äºè£…åˆ†é¡µçš„äº”é¡¹æ•°æ®
		Map<String, Object> pageInfo = new HashMap<>();
		// åˆ†é¡µæŸ¥è¯¢æœ¬é¡µæ•°æ®
		List<HeadlinePageVo> pageData = newsHeadLineDao.findPageList(headLineQueryVo);
		// åˆ†é¡µæŸ¥è¯¢æ»¡è¶³è®°å½•çš„æ€»æ•°æ®é‡
		int totalSize = newsHeadLineDao.findPageCount(headLineQueryVo);
		// é¡µå¤§å°
		int pageSize = headLineQueryVo.getPageSize();
		// æ€»é¡µç æ•°
		int totalPage = totalSize % pageSize == 0 ? totalSize / pageSize : totalSize / pageSize + 1;
		// å½“å‰é¡µç æ•°
		int pageNum = headLineQueryVo.getPageNum();
		pageInfo.put("pageData", pageData);
		pageInfo.put("pageNum", pageNum);
		pageInfo.put("pageSize", pageSize);
		pageInfo.put("totalPage", totalPage);
		pageInfo.put("totalSize", totalSize);

		return pageInfo;
	}
}
```

**NewsHeadLineDao**

```java
package com.atguigu.headline.dao;

import java.util.List;

import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public interface NewsHeadLineDao {
	/**
	 * æ ¹æ®æŸ¥è¯¢æ¡ä»¶,æŸ¥è¯¢æ»¡è¶³æ¡ä»¶çš„è®°å½•æ•°
	 * 
	 * @param headLineQueryVo
	 * @return
	 */
	int findPageCount(HeadlineQueryVo headLineQueryVo);

	/**
	 * æ ¹æ®æŸ¥è¯¢æ¡ä»¶,æŸ¥è¯¢å½“å‰é¡µæ•°æ®
	 * 
	 * @param headLineQueryVo
	 * @return
	 */
	List<HeadlinePageVo> findPageList(HeadlineQueryVo headLineQueryVo);
}
```

**NewsHeadlineDaoImpl**

```java
package com.atguigu.headline.dao.impl;

import java.util.LinkedList;
import java.util.List;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public class NewsHeadlineDaoImpl extends BaseDao implements NewsHeadLineDao {
	@Override
	public int findPageCount(HeadlineQueryVo headLineQueryVo) {
		// æ‹¼æ¥åŠ¨æ€ SQL,æ‹¼æ¥å‚æ•°
		List<Object> args = new LinkedList<>();
		String sql = "select count(1) from news_headline where is_deleted=0 ";
		StringBuilder sqlBuffer = new StringBuilder(sql);
		String keyWords = headLineQueryVo.getKeyWords();
		// åˆ¤æ–­å¹¶åŠ¨æ€æ‹¼æ¥æ¡ä»¶
		if (null != keyWords && keyWords.length() > 0) {
			sqlBuffer.append("and title like ? ");
			args.add("%" + keyWords + "%");
		}
		// åˆ¤æ–­å¹¶åŠ¨æ€æ‹¼æ¥æ¡ä»¶
		Integer type = headLineQueryVo.getType();
		if (null != type && type != 0) {
			sqlBuffer.append("and type  =  ? ");
			args.add(type);
		}

		// å‚æ•°è½¬æ•°ç»„
		Object[] argsArr = args.toArray();
		System.out.println(sqlBuffer.toString());
		Long totalSize = baseQueryObject(Long.class, sqlBuffer.toString(), argsArr);
		// è¿”å›æ•°æ®
		return totalSize.intValue();
	}

	@Override
	public List<HeadlinePageVo> findPageList(HeadlineQueryVo headLineQueryVo) {
		// æ‹¼æ¥åŠ¨æ€ SQL,æ‹¼æ¥å‚æ•°
		List<Object> args = new LinkedList<>();
		String sql = "select hid,title,type,page_views pageViews,TIMESTAMPDIFF(HOUR,create_time,NOW()) pastHours,publisher from news_headline where is_deleted=0 ";
		StringBuilder sqlBuffer = new StringBuilder(sql);
		String keyWords = headLineQueryVo.getKeyWords();
		if (null != keyWords && keyWords.length() > 0) {
			sqlBuffer.append("and title like ? ");
			args.add("%" + keyWords + "%");
		}
		Integer type = headLineQueryVo.getType();
		if (null != type && type != 0) {
			sqlBuffer.append("and type  =  ? ");
			args.add(type);
		}

		sqlBuffer.append("order by pastHours , page_views desc ");
		sqlBuffer.append("limit ? , ?");
		args.add((headLineQueryVo.getPageNum() - 1) * headLineQueryVo.getPageSize());
		args.add(headLineQueryVo.getPageSize());

		// å‚æ•°è½¬æ•°ç»„
		Object[] argsArr = args.toArray();
		System.out.println(sqlBuffer.toString());
		List<HeadlinePageVo> pageData = baseQuery(HeadlinePageVo.class, sqlBuffer.toString(), argsArr);

		return pageData;
	}
}
```

##  æŸ¥çœ‹å¤´æ¡è¯¦æƒ…

<img src="images/1684891013180.png" alt="1684891013180" style="zoom:80%;" />

![1684891029981](images/1684891029981.png)

> éœ€æ±‚è¯´æ˜
>
> - ç”¨æˆ·ç‚¹å‡» "æŸ¥çœ‹å…¨æ–‡" æ—¶ï¼Œå‘æœåŠ¡ç«¯å‘é€æ–°é—» id
> - åç«¯æ ¹æ®æ–°é—» id æŸ¥è¯¢å®Œæ•´æ–°é—»æ–‡ç« ä¿¡æ¯å¹¶è¿”å›
> - åç«¯è¦åŒæ—¶è®©æ–°é—»çš„æµè§ˆé‡ +1

**uri**

``` http
/portal/showHeadlineDetail
```

**è¯·æ±‚æ–¹å¼**

``` http
POST
```

**è¯·æ±‚å‚æ•°**

``` json
hid=1
```

**å“åº”ç¤ºä¾‹**

``` json
{
    "code":"200",
    "message":"success",
    "data":{
        "headline":{
            "hid":"1",                     // æ–°é—»id 
            "title":"é©¬æ–¯å…‹å®£å¸ƒ ... ...",   // æ–°é—»æ ‡é¢˜
            "article":"... ..."            // æ–°é—»æ­£æ–‡
            "type":"1",                    // æ–°é—»æ‰€å±ç±»åˆ«ç¼–å·
            "typeName":"ç§‘æŠ€",             // æ–°é—»æ‰€å±ç±»åˆ«
            "pageViews":"40",              // æ–°é—»æµè§ˆé‡
            "pastHours":"3" ,              // å‘å¸ƒæ—¶é—´å·²è¿‡å°æ—¶æ•°
            "publisher":"1" ,               // å‘å¸ƒç”¨æˆ·ID
            "author":"å¼ ä¸‰"                 // æ–°é—»ä½œè€…
        }
    }
}
```

### åç«¯ä»£ç 

**PortalController**

```java
package com.atguigu.headline.controller;

import java.io.IOException;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsType;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.NewsTypeService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.service.impl.NewsTypeServiceImpl;
import com.atguigu.headline.util.WebUtil;

@WebServlet("/portal/*")
public class PortalController extends BaseController {
	private NewsHeadlineService headlineService = new NewsHeadlineServiceImpl();
	private NewsTypeService newsTypeService = new NewsTypeServiceImpl();

	/**
	 * æŸ¥è¯¢å•ä¸ªæ–°é—»è¯¦æƒ…
	 * 
	 * @param req
	 * @param resp
	 * @throws ServletException
	 * @throws IOException
	 */
	protected void showHeadlineDetail(HttpServletRequest req, HttpServletResponse resp)
			throws ServletException, IOException {
		// è·å–è¦æŸ¥è¯¢çš„è¯¦æƒ…æ–°é—»id
		Integer hid = Integer.parseInt(req.getParameter("hid"));

		// æŸ¥è¯¢æ–°é—»è¯¦æƒ…vo
		HeadlineDetailVo headlineDetailVo = headlineService.findHeadlineDetail(hid);
		// å°è£…dataå†…å®¹
		Map<String, Object> data = new HashMap<>();
		data.put("headline", headlineDetailVo);
		// å“åº”JSON
		WebUtil.writeJson(resp, Result.ok(data));
	}
}
```

**NewsHeadlineService**

```java
package com.atguigu.headline.service;

import java.util.Map;

import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public interface NewsHeadlineService {
	/**
	 * æ ¹æ®å¤´æ¡id,æ˜¾ç¤ºå¤´æ¡è¯¦æƒ…
	 * 
	 * @param hid
	 * @return
	 */
	HeadlineDetailVo findHeadlineDetail(Integer hid);
}
```

**NewsHeadlineServiceImpl**

```java
package com.atguigu.headline.service.impl;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;

public class NewsHeadlineServiceImpl implements NewsHeadlineService {
	private NewsHeadLineDao newsHeadLineDao = new NewsHeadlineDaoImpl();

	@Override
	public HeadlineDetailVo findHeadlineDetail(Integer hid) {
		// ä¿®æ”¹æ–°é—»ä¿¡æ¯æµè§ˆé‡+1
		newsHeadLineDao.increasePageViews(hid);
		// æŸ¥è¯¢æ–°é—»è¯¦æƒ…
		return newsHeadLineDao.findHeadlineDetail(hid);
	}
}
```

**NewsHeadLineDao**

```java
package com.atguigu.headline.dao;

import java.util.List;

import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public interface NewsHeadLineDao {
	/**
	 * å¤šè¡¨æŸ¥è¯¢æ–°é—»è¯¦æƒ…
	 * 
	 * @param hid
	 * @return
	 */
	HeadlineDetailVo findHeadlineDetail(Integer hid);

	int increasePageViews(Integer hid);
}
```

**NewsHeadlineDaoImpl**

```java
package com.atguigu.headline.dao.impl;

import java.util.LinkedList;
import java.util.List;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public class NewsHeadlineDaoImpl extends BaseDao implements NewsHeadLineDao {
	@Override
	public HeadlineDetailVo findHeadlineDetail(Integer hid) {
		String sql = "select hid,title,article,type, tname typeName ,page_views pageViews,TIMESTAMPDIFF(HOUR,create_time,NOW()) pastHours,publisher,nick_name author from news_headline h left join  news_type t on h.type = t.tid left join news_user u  on h.publisher = u.uid where hid = ?";
		List<HeadlineDetailVo> headlineDetailVoList = baseQuery(HeadlineDetailVo.class, sql, hid);
		if (null != headlineDetailVoList && headlineDetailVoList.size() > 0)
			return headlineDetailVoList.get(0);
		return null;
	}

	@Override
	public int increasePageViews(Integer hid) {
		String sql = "update news_headline set page_views = page_views +1 where hid =?";
		return baseUpdate(sql, hid);
	}
}
```

# å¤´æ¡å‘å¸ƒä¿®æ”¹å’Œåˆ é™¤

## ç™»å½•æ ¡éªŒ

> éœ€æ±‚è¯´æ˜
>
> - å®¢æˆ·ç«¯åœ¨è¿›å…¥å‘å¸ƒé¡µå‰ã€å‘å¸ƒæ–°é—»å‰ã€è¿›å…¥ä¿®æ”¹é¡µå‰ã€ä¿®æ”¹å‰ã€åˆ é™¤æ–°é—»å‰å…ˆå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æºå¸¦token è¯·æ±‚å¤´
> - åç«¯æ¥æ”¶ token è¯·æ±‚å¤´åï¼Œæ ¡éªŒç”¨æˆ·ç™»å½•æ˜¯å¦è¿‡æœŸå¹¶åšå“åº”
> - å‰ç«¯æ ¹æ®å“åº”ä¿¡æ¯æç¤ºç”¨æˆ·è¿›å…¥ç™»å½•é¡µè¿˜æ˜¯è¿›å…¥æ­£å¸¸ä¸šåŠ¡é¡µé¢

**uri**

``` http
/user/checkLogin
```

**è¯·æ±‚æ–¹å¼**

``` http
GET
```

**è¯·æ±‚å‚æ•°**

``` json
æ— 
```

**è¯·æ±‚å¤´**

``` JSON
token: ... ...
```

**ç™»å½•æœªè¿‡æœŸ**

``` json
{
    "code":"200",
    "message":"success",
    "data":{}
}
```

**ç™»å½•å·²è¿‡æœŸ**

``` json
{
    "code":"504",
    "message":"loginExpired",
    "data":{}
}
```

### åç«¯ä»£ç 

**NewsUserController**

```java
package com.atguigu.headline.controller;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.common.ResultCodeEnum;
import com.atguigu.headline.pojo.NewsUser;
import com.atguigu.headline.service.NewsUserService;
import com.atguigu.headline.service.impl.NewsUserServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.MD5Util;
import com.atguigu.headline.util.WebUtil;

@WebServlet("/user/*")
public class NewsUserController extends BaseController {
	private NewsUserService newsUserService = new NewsUserServiceImpl();

	/**
	 * é€šè¿‡tokenæ£€éªŒç”¨æˆ·ç™»å½•æ˜¯å¦è¿‡æœŸ
	 * 
	 * @param req
	 * @param resp
	 * @throws ServletException
	 * @throws IOException
	 */
	protected void checkLogin(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		String token = req.getHeader("token");
		Result result = Result.build(null, ResultCodeEnum.NOTLOGIN);
		if (null != token) {
			if (!JwtHelper.isExpiration(token)) {
				result = Result.ok(null);
			}
		}
		WebUtil.writeJson(resp, result);
	}
}
```

**ç™»å½•æ ¡éªŒè¿‡æ»¤å™¨**

```java
package com.atguigu.headline.filters;

import java.io.IOException;

import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.common.ResultCodeEnum;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.WebUtil;

public class LoginFilter implements Filter {
	@Override
	public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)
			throws IOException, ServletException {
		HttpServletRequest request = (HttpServletRequest) servletRequest;
		String token = request.getHeader("token");
		boolean flag = false;
		// tokenä¸ä¸ºç©ºå¹¶ä¸”æ²¡è¿‡æœŸ
		if (null != token) {
			boolean expiration = JwtHelper.isExpiration(token);
			if (!expiration) {
				flag = true;
			}
		}
		if (flag) {
			filterChain.doFilter(servletRequest, servletResponse);
		} else {
			WebUtil.writeJson((HttpServletResponse) servletResponse, Result.build(null, ResultCodeEnum.NOTLOGIN));
		}
	}
}
```

**web.xml ä¸­é…ç½®ç™»å½•æ ¡éªŒè¿‡æ»¤å™¨**

```xml
<!--ç™»å½•æ ¡éªŒè¿‡æ»¤å™¨ -->
<filter>
    <filter-name>loginFilter</filter-name>
    <filter-class>com.atguigu.headline.filters.LoginFilter</filter-class>
</filter>
<filter-mapping>
    <filter-name>loginFilter</filter-name>
    <url-pattern>/headline/*</url-pattern>
</filter-mapping>
```

## æäº¤å‘å¸ƒå¤´æ¡

![1683883660552](images/1683883660552.png)

> éœ€æ±‚è¯´æ˜
>
> - ç”¨æˆ·åœ¨å®¢æˆ·ç«¯è¾“å…¥å‘å¸ƒçš„æ–°é—»ä¿¡æ¯å®Œæ¯•å
> - å‘å¸ƒå‰å…ˆè¯·æ±‚åç«¯çš„ç™»å½•æ ¡éªŒæ¥å£éªŒè¯ç™»å½•
> - ç™»å½•é€šè¿‡åˆ™æäº¤æ–°é—»ä¿¡æ¯
> - åç«¯å°†æ–°é—»ä¿¡æ¯å­˜å…¥æ•°æ®åº“

**uri**

``` http
/headline/publish
```

**è¯·æ±‚æ–¹å¼**

``` http
POST
```

**è¯·æ±‚å¤´**

``` json
token: ... ...
```

**è¯·æ±‚å‚æ•°**

``` json
{
    "title":"å°šç¡…è°·å®£å¸ƒ ... ...",   // æ–‡ç« æ ‡é¢˜
    "article":"... ...",          // æ–‡ç« å†…å®¹
    "type":"1"                    // æ–‡ç« ç±»åˆ«
}
```

**å‘å¸ƒæˆåŠŸ**

``` json
{
    "code":"200",
    "message":"success",
    "data":{}
}
```

**å¤±å»ç™»å½•çŠ¶æ€å‘å¸ƒå¤±è´¥**

```  json
{
    "code":"504",
    "message":"loginExpired",
    "data":{}
}
```



### åç«¯ä»£ç 

**NewsHeadlineController**

```java
package com.atguigu.headline.controller;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.WebUtil;

@WebServlet("/headline/*")
public class NewsHeadlineController extends BaseController {
	private NewsHeadlineService newsHeadlineService = new NewsHeadlineServiceImpl();

	/**
	 * å‘å¸ƒæ–°é—»
	 * 
	 * @param req
	 * @param resp
	 * @throws ServletException
	 * @throws IOException
	 */
	protected void publish(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		// è¯»å–æ–°é—»ä¿¡æ¯
		NewsHeadline newsHeadline = WebUtil.readJson(req, NewsHeadline.class);
		// é€šè¿‡tokenè·å–å‘å¸ƒè€…ID
		String token = req.getHeader("token");
		Long userId = JwtHelper.getUserId(token);
		newsHeadline.setPublisher(userId.intValue());
		// å°†æ–°é—»å­˜å…¥æ•°æ®åº“
		newsHeadlineService.addNewsHeadline(newsHeadline);
		WebUtil.writeJson(resp, Result.ok(null));
	}
}
```

**NewsHeadlineService**

```java
package com.atguigu.headline.service;

import java.util.Map;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public interface NewsHeadlineService {
	/**
	 * æ–°å¢å¤´æ¡
	 * 
	 * @param newsHeadline
	 * @return
	 */
	int addNewsHeadline(NewsHeadline newsHeadline);
}
```

**NewsHeadlineServiceImpl**

```java
package com.atguigu.headline.service.impl;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;

public class NewsHeadlineServiceImpl implements NewsHeadlineService {
	private NewsHeadLineDao newsHeadLineDao = new NewsHeadlineDaoImpl();

    @Override
	public int addNewsHeadline(NewsHeadline newsHeadline) {
		return newsHeadLineDao.addNewsHeadline(newsHeadline);
	}
}
```

**NewsHeadLineDao**

```java
package com.atguigu.headline.dao;

import java.util.List;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public interface NewsHeadLineDao {
	/**
	 * å¤´æ¡å­˜å…¥æ•°æ®åº“
	 * 
	 * @param newsHeadline
	 * @return
	 */
	int addNewsHeadline(NewsHeadline newsHeadline);
}
```

**NewsHeadlineDaoImpl**

```java
package com.atguigu.headline.dao.impl;

import java.util.LinkedList;
import java.util.List;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public class NewsHeadlineDaoImpl extends BaseDao implements NewsHeadLineDao {
	@Override
	public int addNewsHeadline(NewsHeadline newsHeadline) {
		String sql = "insert into news_headline values(DEFAULT,?,?,?,?,0,NOW(),NOW(),0)";

		return baseUpdate(sql, newsHeadline.getTitle(), newsHeadline.getArticle(), newsHeadline.getType(),
				newsHeadline.getPublisher());
	}
}
```

## ä¿®æ”¹å¤´æ¡å›æ˜¾

![1683883695289](images/1683883695289.png)

> éœ€æ±‚è¯´æ˜
>
> - å‰ç«¯å…ˆè°ƒç”¨ç™»å½•æ ¡éªŒæ¥å£ï¼Œæ ¡éªŒç™»å½•æ˜¯å¦è¿‡æœŸ
> - ç™»å½•æ ¡éªŒé€šè¿‡åï¼Œåˆ™æ ¹æ®æ–°é—» id æŸ¥è¯¢æ–°é—»çš„å®Œæ•´ä¿¡æ¯å¹¶å“åº”ç»™å‰ç«¯

**uri**

``` http
/headline/findHeadlineByHid
```

**è¯·æ±‚æ–¹å¼**

``` http
POST
```

**è¯·æ±‚å‚æ•°**

``` json
hid=1
```

**æŸ¥è¯¢æˆåŠŸ**

``` json
{
    "code":"200",
    "message":"success",
    "data":{
        "headline":{
            "hid":"1",
            "title":"é©¬æ–¯å…‹å®£å¸ƒ",
            "article":"... ... ",
            "type":"2"
        }
    }
}
```

### åç«¯ä»£ç 

**NewsHeadlineController**

```java
package com.atguigu.headline.controller;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.WebUtil;

@WebServlet("/headline/*")
public class NewsHeadlineController extends BaseController {
	private NewsHeadlineService newsHeadlineService = new NewsHeadlineServiceImpl();

	/**
	 * ä¿®æ”¹æ–°é—»å›æ˜¾
	 * 
	 * @param req
	 * @param resp
	 * @throws ServletException
	 * @throws IOException
	 */
	protected void findHeadlineByHid(HttpServletRequest req, HttpServletResponse resp)
			throws ServletException, IOException {
		Integer hid = Integer.parseInt(req.getParameter("hid"));
		NewsHeadline newsHeadline = newsHeadlineService.findHeadlineByHid(hid);
		Map<String, Object> data = new HashMap<>();
		data.put("headline", newsHeadline);
		WebUtil.writeJson(resp, Result.ok(data));

	}
}
```

**NewsHeadlineService**

```java
package com.atguigu.headline.service;

import java.util.Map;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public interface NewsHeadlineService {
	/**
	 * æ ¹æ®æ–°é—»idæŸ¥è¯¢å•ä¸ªæ–°é—»
	 * 
	 * @param hid
	 * @return
	 */
	NewsHeadline findHeadlineByHid(Integer hid);
}
```

**NewsHeadlineServiceImpl**

```java
package com.atguigu.headline.service.impl;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;

public class NewsHeadlineServiceImpl implements NewsHeadlineService {
	private NewsHeadLineDao newsHeadLineDao = new NewsHeadlineDaoImpl();
	
    @Override
    public NewsHeadline findHeadlineByHid(Integer hid) {
        return newsHeadLineDao.findHeadlineByHid(hid);
    }
}
```

**NewsHeadLineDao**

```java
package com.atguigu.headline.dao;

import java.util.List;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public interface NewsHeadLineDao {
	NewsHeadline findHeadlineByHid(Integer hid);
}
```

**NewUserDaoImpl**

```java
package com.atguigu.headline.dao.impl;

import java.util.LinkedList;
import java.util.List;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public class NewsHeadlineDaoImpl extends BaseDao implements NewsHeadLineDao {
	@Override
	public NewsHeadline findHeadlineByHid(Integer hid) {
		String sql = "select hid,title,article,type,publisher,page_views pageViews from news_headline where hid =?";
		List<NewsHeadline> newsHeadlineList = baseQuery(NewsHeadline.class, sql, hid);
		if (null != newsHeadlineList && newsHeadlineList.size() > 0)
			return newsHeadlineList.get(0);
		return null;
	}
}
```

## ä¿å­˜ä¿®æ”¹

> éœ€æ±‚æè¿°
>
> - å®¢æˆ·ç«¯å°†æ–°é—»ä¿¡æ¯ä¿®æ”¹åï¼Œæäº¤å‰å…ˆè¯·æ±‚ç™»å½•æ ¡éªŒæ¥å£æ ¡éªŒç™»å½•çŠ¶æ€
> - ç™»å½•æ ¡éªŒé€šè¿‡åˆ™æäº¤ä¿®æ”¹åçš„æ–°é—»ä¿¡æ¯ï¼Œåç«¯æ¥æ”¶å¹¶æ›´æ–°è¿›å…¥æ•°æ®åº“

**uri**

``` http
/headline/update
```

**è¯·æ±‚æ–¹å¼** 

``` http
POST
```

**è¯·æ±‚å‚æ•°**

``` JSON
{
    "hid":"1",
    "title":"å°šç¡…è°·å®£å¸ƒ ... ...",
    "article":"... ...",
    "type":"2"
}
```

**ä¿®æ”¹æˆåŠŸ**

``` json
{
    "code":"200",
    "message":"success",
    "data":{}
}
```

**ä¿®æ”¹å¤±è´¥**

```  json
{
    "code":"504",
    "message":"loginExpired",
    "data":{}
}
```

### åç«¯ä»£ç 

**NewsHeadlineController**

```java
package com.atguigu.headline.controller;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.WebUtil;

@WebServlet("/headline/*")
public class NewsHeadlineController extends BaseController {
	private NewsHeadlineService newsHeadlineService = new NewsHeadlineServiceImpl();

	/**
	 * æ›´æ–°æ–°é—»ä¿¡æ¯
	 * 
	 * @param req
	 * @param resp
	 * @throws ServletException
	 * @throws IOException
	 */
	protected void update(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		NewsHeadline newsHeadline = WebUtil.readJson(req, NewsHeadline.class);
		newsHeadlineService.updateNewsHeadline(newsHeadline);
		WebUtil.writeJson(resp, Result.ok(null));
	}
}
```

**NewsHeadlineService**

```java
package com.atguigu.headline.service;

import java.util.Map;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public interface NewsHeadlineService {
	int updateNewsHeadline(NewsHeadline newsHeadline);
}
```

**NewsHeadlineServiceImpl**

```java
package com.atguigu.headline.service.impl;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;

public class NewsHeadlineServiceImpl implements NewsHeadlineService {
	private NewsHeadLineDao newsHeadLineDao = new NewsHeadlineDaoImpl();

    @Override
    public int updateNewsHeadline(NewsHeadline newsHeadline) {
        return newsHeadLineDao.updateNewsHeadline(newsHeadline);
    }
}
```

**NewsHeadLineDao**

```java
package com.atguigu.headline.dao;

import java.util.List;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public interface NewsHeadLineDao {
	int updateNewsHeadline(NewsHeadline newsHeadline);
}
```

**NewUserDaoImpl**

```java
package com.atguigu.headline.dao.impl;

import java.util.LinkedList;
import java.util.List;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public class NewsHeadlineDaoImpl extends BaseDao implements NewsHeadLineDao {
	@Override
	public int updateNewsHeadline(NewsHeadline newsHeadline) {
		String sql = "update news_headline set title = ?, article= ? , type =? , update_time = NOW() where hid = ? ";
		return baseUpdate(sql, newsHeadline.getTitle(), newsHeadline.getArticle(), newsHeadline.getType(),
				newsHeadline.getHid());
	}
}
```

## åˆ é™¤å¤´æ¡

![1683883724768](images/1683883724768.png)

> éœ€æ±‚è¯´æ˜
>
> - å°†è¦åˆ é™¤çš„æ–°é—» id å‘é€ç»™æœåŠ¡ç«¯
> - æœåŠ¡ç«¯æ ¡éªŒç™»å½•æ˜¯å¦è¿‡æœŸï¼Œæœªè¿‡æœŸåˆ™ç›´æ¥åˆ é™¤ï¼Œè¿‡æœŸåˆ™å“åº”ç™»å½•è¿‡æœŸä¿¡æ¯



**uri**

``` http
/headline/removeByHid
```

**è¯·æ±‚æ–¹å¼**

``` http
POST
```

**è¯·æ±‚å‚æ•°**

```  json
hid=1
```

**åˆ é™¤æˆåŠŸ**

``` json
{
    "code":"200",
    "message":"success",
    "data":{}
}
```

**åˆ é™¤å¤±è´¥**

``` json
{
    "code":"504",
    "message":"loginExpired",
    "data":{}
    
}
```

### åç«¯ä»£ç 

**NewsHeadlineController**

```java
package com.atguigu.headline.controller;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.atguigu.headline.common.Result;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.service.NewsHeadlineService;
import com.atguigu.headline.service.impl.NewsHeadlineServiceImpl;
import com.atguigu.headline.util.JwtHelper;
import com.atguigu.headline.util.WebUtil;

@WebServlet("/headline/*")
public class NewsHeadlineController extends BaseController {
	private NewsHeadlineService newsHeadlineService = new NewsHeadlineServiceImpl();

	/**
	 * åˆ é™¤æ–°é—»
	 * 
	 * @param req
	 * @param resp
	 * @throws ServletException
	 * @throws IOException
	 */
	protected void removeByHid(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		Integer hid = Integer.parseInt(req.getParameter("hid"));
		newsHeadlineService.removeByHid(hid);
		WebUtil.writeJson(resp, Result.ok(null));
	}
}
```

**NewsHeadlineService**

```java
package com.atguigu.headline.service;

import java.util.Map;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public interface NewsHeadlineService {
	int removeByHid(Integer hid);
}
```

**NewsHeadlineServiceImpl**

```java
package com.atguigu.headline.service.impl;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.dao.impl.NewsHeadlineDaoImpl;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;
import com.atguigu.headline.service.NewsHeadlineService;

public class NewsHeadlineServiceImpl implements NewsHeadlineService {
	private NewsHeadLineDao newsHeadLineDao = new NewsHeadlineDaoImpl();

	@Override
	public int removeByHid(Integer hid) {
		return newsHeadLineDao.removeByHid(hid);
	}
}
```

**NewsHeadLineDao**

```java
package com.atguigu.headline.dao;

import java.util.List;

import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public interface NewsHeadLineDao {
	int removeByHid(Integer hid);
}
```

**NewsHeadlineDaoImpl**

```java
package com.atguigu.headline.dao.impl;

import java.util.LinkedList;
import java.util.List;

import com.atguigu.headline.dao.BaseDao;
import com.atguigu.headline.dao.NewsHeadLineDao;
import com.atguigu.headline.pojo.NewsHeadline;
import com.atguigu.headline.pojo.vo.HeadlineDetailVo;
import com.atguigu.headline.pojo.vo.HeadlinePageVo;
import com.atguigu.headline.pojo.vo.HeadlineQueryVo;

public class NewsHeadlineDaoImpl extends BaseDao implements NewsHeadLineDao {
	@Override
	public int removeByHid(Integer hid) {
		String sql = "update news_headline set is_deleted =1 ,  update_time =NOW() where hid = ? ";
		return baseUpdate(sql, hid);
	}
}
```



# æš«å­˜

- [vue3ä¸­defineComponent çš„ä½œç”¨è¯¦è§£](https://juejin.cn/post/7198426159478456381)

- [Vue3 ä¸­ createWebHistory å’Œ createWebHashHistory çš„åŒºåˆ«](https://blog.csdn.net/weixin_44917334/article/details/129387658)